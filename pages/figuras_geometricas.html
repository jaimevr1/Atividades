<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figuras Geom√©tricas com Roblox</title>
    
    <!-- Depend√™ncias Padr√£o (React, TailwindCSS, Fontes) -->
    <link href="https://fonts.googleapis.com/css2?family=Comic+Sans+MS:wght@400;700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../VariableProximity.css">
    <script src="../variable-proximity-effect.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @font-face {
          font-family: 'OpenDyslexic';
          src: url('../media/fonts/OpenDyslexic-Regular.otf') format('opentype');
          font-weight: normal;
          font-style: normal;
        }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .font-dyslexic {
            font-family: 'OpenDyslexic', 'Comic Sans MS', cursive, sans-serif;
        }
        .correct-answer-animation {
            animation: pulse-green 0.8s ease-in-out;
        }
        @keyframes pulse-green {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 10px 10px rgba(34, 197, 94, 0); }
        }
        .wrong-answer-animation {
            animation: shake-red 0.5s ease-in-out;
        }
        @keyframes shake-red {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .celebration-popup {
            animation: fade-in 0.5s ease-out;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        

        // ===================================================================================
        // --- CONFIGURA√á√ÉO DA ATIVIDADE ---
        // ===================================================================================
        const activityConfig = {
            title: "Figuras Geom√©tricas com Roblox",
            subject: "matematica",
            activity: "figuras_geometricas_roblox",
            emoji: "üî∑",
            primaryColor: "blue",
        };

        const activityBlocks = [
            {
                id: 1,
                title: "Aventura do Construtor Novato",
                difficulty: "Iniciante",
                emoji: "‚≠ê",
                color: "from-yellow-400 to-amber-500",
                description: "Combine as formas mais simples para come√ßar sua jornada.",
                challenge: {
                    id: "bloco_1_desafio_1",
                    figures: ['c√≠rculo', 'quadrado', 'tri√¢ngulo', 'ret√¢ngulo'],
                    targets: [
                        { id: 1, name: 'Cabe√ßa do Personagem', shape: 'c√≠rculo', emoji: 'üòÄ' },
                        { id: 2, name: 'Bloco de Terra', shape: 'quadrado', emoji: 'üü´' },
                        { id: 3, name: 'Telhado Pontudo', shape: 'tri√¢ngulo', emoji: 'üîº' },
                        { id: 4, name: 'Porta M√°gica', shape: 'ret√¢ngulo', emoji: 'üö™' },
                        { id: 5, name: 'Janela da Casa', shape: 'quadrado', emoji: 'ü™ü' }
                    ]
                }
            },
            {
                id: 2,
                title: "Miss√£o: Lar Doce Lar Geom√©trico",
                difficulty: "Iniciante",
                emoji: "üè†",
                color: "from-green-400 to-teal-500",
                description: "Use as formas para construir uma casa incr√≠vel.",
                challenge: {
                    id: "bloco_2_desafio_1",
                    figures: ['quadrado', 'ret√¢ngulo', 'tri√¢ngulo', 'c√≠rculo', 'losango'],
                    targets: [
                        { id: 1, name: 'Janela Panor√¢mica', shape: 'quadrado', emoji: 'üñºÔ∏è' },
                        { id: 2, name: 'Parede de Tijolos', shape: 'ret√¢ngulo', emoji: 'üß±' },
                        { id: 3, name: 'Telhado Principal', shape: 'tri√¢ngulo', emoji: 'üè°' },
                        { id: 4, name: 'Rodas do Carrinho', shape: 'c√≠rculo', emoji: '‚ö´' },
                        { id: 5, name: 'Piso de Diamante', shape: 'losango', emoji: 'üí†' }
                    ]
                }
            },
            {
                id: 3,
                title: "A Forja do Her√≥i Poligonal",
                difficulty: "Intermedi√°rio",
                emoji: "üõ°Ô∏è",
                color: "from-blue-400 to-cyan-500",
                description: "Equipe seu her√≥i com itens feitos de pol√≠gonos.",
                challenge: {
                    id: "bloco_3_desafio_1",
                    figures: ['pent√°gono', 'hex√°gono', 'oct√≥gono', 'tri√¢ngulo', 'c√≠rculo'],
                    targets: [
                        { id: 1, name: 'Escudo do Guardi√£o', shape: 'pent√°gono', emoji: 'üõ°Ô∏è' },
                        { id: 2, name: 'N√∫cleo de Energia', shape: 'hex√°gono', emoji: '‚öôÔ∏è' },
                        { id: 3, name: 'Sinal de Pare', shape: 'oct√≥gono', emoji: 'üõë' },
                        { id: 4, name: 'Chap√©u do Mago', shape: 'tri√¢ngulo', emoji: 'üßô' },
                        { id: 5, name: 'Lente dos √ìculos', shape: 'c√≠rculo', emoji: 'üï∂Ô∏è' }
                    ]
                }
            },
            {
                id: 4,
                title: "O Desafio da Pista Radical",
                difficulty: "Intermedi√°rio",
                emoji: "üõπ",
                color: "from-purple-400 to-fuchsia-500",
                description: "Construa uma pista de obst√°culos com quadril√°teros.",
                challenge: {
                    id: "bloco_4_desafio_1",
                    figures: ['ret√¢ngulo', 'c√≠rculo', 'tri√¢ngulo', 'trap√©zio', 'paralelogramo'],
                    targets: [
                        { id: 1, name: 'T√∫nel Escuro', shape: 'ret√¢ngulo', emoji: 'üöá' },
                        { id: 2, name: 'Roda Gigante', shape: 'c√≠rculo', emoji: 'üé°' },
                        { id: 3, name: 'Rampa de Salto', shape: 'tri√¢ngulo', emoji: 'üìê' },
                        { id: 4, name: 'Plataforma Inclinada', shape: 'trap√©zio', emoji: 'üé¢' },
                        { id: 5, name: 'Ponte Deslizante', shape: 'paralelogramo', emoji: 'üåâ' }
                    ]
                }
            },
            {
                id: 5,
                title: "Modo Criativo: Arquiteto de Games",
                difficulty: "Avan√ßado",
                emoji: "üéÆ",
                color: "from-red-500 to-orange-500",
                description: "Crie os elementos de um jogo usando formas complexas.",
                challenge: {
                    id: "bloco_5_desafio_1",
                    figures: ['c√≠rculo', 'quadrado', 'tri√¢ngulo', 'hex√°gono', 'oct√≥gono'],
                    targets: [
                        { id: 1, name: 'Bot√£o de Start', shape: 'c√≠rculo', emoji: '‚ñ∂Ô∏è' },
                        { id: 2, name: 'Plataforma Flutuante', shape: 'quadrado', emoji: 'üü©' },
                        { id: 3, name: 'Seta de Dire√ß√£o', shape: 'tri√¢ngulo', emoji: '‚û°Ô∏è' },
                        { id: 4, name: 'Favo de Mel Premiado', shape: 'hex√°gono', emoji: 'üçØ' },
                        { id: 5, name: 'Portal de Teletransporte', shape: 'oct√≥gono', emoji: 'üåÄ' }
                    ]
                }
            },
            // Aventuras Gal√°cticas de Figuras Planas
            {
                id: 6,
                title: "Tri√¢ngulo Tit√£ üõ∏",
                difficulty: "Iniciante",
                emoji: "üî∫",
                color: "from-yellow-400 to-orange-500",
                description: "Descubra onde o tri√¢ngulo se esconde na gal√°xia!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q1",
                        statement: "Qual dessas formas tem 3 lados e 3 v√©rtices?",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "‚≠ï C√≠rculo" },
                            { id: "d", text: "‚ñ≠ Ret√¢ngulo" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üéâ Isso mesmo! O tri√¢ngulo tem 3 lados. Veja a constela√ß√£o se formando... üåü",
                            incorrect: "üí° Quase! O tri√¢ngulo √© a forma com 3 lados. Olhe bem nos cantos!"
                        }
                    },
                    {
                        id: "q2",
                        statement: "Qual objeto do espa√ßo parece um tri√¢ngulo?",
                        options: [
                            { id: "a", text: "üõ∏ OVNI" },
                            { id: "b", text: "ü™ê Planeta" },
                            { id: "c", text: "‚òÑÔ∏è Cometa" },
                            { id: "d", text: "üõ∞Ô∏è Sat√©lite" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üöÄ UAU! Muitos OVNIs s√£o desenhados como tri√¢ngulos! Constela√ß√£o atualizada! üî∫",
                            incorrect: "üõ∏ Dica: pense em naves famosas... Elas costumam ter formato de tri√¢ngulo!"
                        }
                    },
                    {
                        id: "q3",
                        statement: "Em uma pizza triangular, quantos peda√ßos voc√™ obt√©m se cortar do centro at√© cada ponta?",
                        options: [
                            { id: "a", text: "2 peda√ßos" },
                            { id: "b", text: "3 peda√ßos" },
                            { id: "c", text: "4 peda√ßos" },
                            { id: "d", text: "6 peda√ßos" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üçï DELICIOSO! 3 cortes do centro = 3 peda√ßos triangulares! Que fome c√≥smica! üåü",
                            incorrect: "üî∫ Dica: cada lado do tri√¢ngulo gera um peda√ßo!"
                        }
                    },
                    {
                        id: "q4",
                        statement: "Qual instrumento musical tem formato triangular?",
                        options: [
                            { id: "a", text: "üé∏ Viol√£o" },
                            { id: "b", text: "ü•Å Bateria" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "üéπ Piano" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üéµ M√öSICA PERFEITA! O tri√¢ngulo musical faz aquele som m√°gico! üî∫‚ú®",
                            incorrect: "üé∂ Dica: tem o mesmo nome da figura geom√©trica!"
                        }
                    },
                    {
                        id: "q5",
                        statement: "Se voc√™ juntar dois tri√¢ngulos iguais pela base, que figura forma?",
                        options: [
                            { id: "a", text: "üî∑ Quadrado" },
                            { id: "b", text: "üî∏ Losango" },
                            { id: "c", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üíé DIAMANTE ESTELAR! Dois tri√¢ngulos = um losango brilhante! üåüüî∏",
                            incorrect: "üî∫‚ûïüî∫ Dica: fica com formato de diamante!"
                        }
                    }
                ]
            },
            {
                id: 7,
                title: "Quadrado Quantum üí•",
                difficulty: "Intermedi√°rio",
                emoji: "üî∑",
                color: "from-purple-400 to-pink-500",
                description: "Desvende os segredos dos 4 lados iguais!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q3",
                        statement: "Quantos lados tem um quadrado?",
                        options: [
                            { id: "a", text: "2" },
                            { id: "b", text: "3" },
                            { id: "c", text: "4" },
                            { id: "d", text: "5" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üî¢ Perfeito! 4 lados iguais = quadrado! A constela√ß√£o brilha mais! ‚ú®",
                            incorrect: "üìè Dica: 'Quadra' vem de quatro! Sempre 4 lados!"
                        }
                    },
                    {
                        id: "q4",
                        statement: "Qual janela de foguete √© um quadrado?",
                        options: [
                            { id: "a", text: "ü™ü Redonda" },
                            { id: "b", text: "üî∑ Com 4 lados iguais" },
                            { id: "c", text: "‚ñ≠ Longa e fina" },
                            { id: "d", text: "üî∫ Pontuda" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üëÄ Excelente! O quadrado √© perfeito para janelas fortes! Nova estrela conectada! ‚≠ê",
                            incorrect: "ü™û Pense: qual tem todos os lados do mesmo tamanho?"
                        }
                    },
                    {
                        id: "q6",
                        statement: "Um dado de jogo tem quantas faces quadradas?",
                        options: [
                            { id: "a", text: "4 faces" },
                            { id: "b", text: "5 faces" },
                            { id: "c", text: "6 faces" },
                            { id: "d", text: "8 faces" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üé≤ SORTE M√ÅXIMA! 6 faces quadradas fazem o cubo perfeito! Quantum ativado! ‚ö°",
                            incorrect: "üî¢ Dica: conte as faces de um cubo m√°gico!"
                        }
                    },
                    {
                        id: "q7",
                        statement: "Qual destas telas tem formato mais pr√≥ximo de um quadrado?",
                        options: [
                            { id: "a", text: "üì± Celular vertical" },
                            { id: "b", text: "üì∫ TV widescreen" },
                            { id: "c", text: "üíª Monitor quadrado" },
                            { id: "d", text: "üìè R√©gua digital" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üíª TELA QU√ÇNTICA! Monitor quadrado = perfei√ß√£o geom√©trica! üî∑‚ú®",
                            incorrect: "üñ•Ô∏è Dica: procure pela tela mais 'quadradinha'!"
                        }
                    },
                    {
                        id: "q8",
                        statement: "Em um tabuleiro de xadrez, cada casa √© um:",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "‚≠ï C√≠rculo" },
                            { id: "d", text: "üî∏ Losango" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "‚ôüÔ∏è XEQUE-MATE GEOM√âTRICO! 64 quadrados perfeitos no tabuleiro! üèÜ",
                            incorrect: "‚ôõ Dica: cada casa do xadrez tem 4 lados iguais!"
                        }
                    }
                ]
            },
            {
                id: 8,
                title: "C√≠rculo C√≥smico üåï",
                difficulty: "Iniciante",
                emoji: "‚≠ï",
                color: "from-blue-400 to-cyan-500",
                description: "Rode pelo universo redondo e encontre os c√≠rculos!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q5",
                        statement: "Qual figura N√ÉO tem lados nem v√©rtices?",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "‚≠ï C√≠rculo" },
                            { id: "d", text: "‚ñ≠ Ret√¢ngulo" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üåÄ Isso! O c√≠rculo √© redondinho e sem pontas! A lua sorri para voc√™! üåï",
                            incorrect: "üñêÔ∏è Dica: procure a figura que rola sem esbarrar!"
                        }
                    },
                    {
                        id: "q6",
                        statement: "Qual planeta √© redondo como um c√≠rculo?",
                        options: [
                            { id: "a", text: "ü™ê Saturno" },
                            { id: "b", text: "‚òÑÔ∏è Cometa" },
                            { id: "c", text: "üõ∞Ô∏è Antena" },
                            { id: "d", text: "üöÄ Foguete" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "ü™ê Parab√©ns! Todos os planetas s√£o redondos! Voc√™ iluminou a gal√°xia! üåå",
                            incorrect: "üåç Dica: gira, gira‚Ä¶ e √© redondo como uma bola!"
                        }
                    },
                    {
                        id: "q9",
                        statement: "Qual dessas rodas √© a mais redonda?",
                        options: [
                            { id: "a", text: "üõû Roda de carro" },
                            { id: "b", text: "‚¨ú Roda quadrada" },
                            { id: "c", text: "üî∫ Roda triangular" },
                            { id: "d", text: "‚ñ≠ Roda retangular" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üöó PERFEITO! Rodas de carro s√£o c√≠rculos perfeitos para rolar suave! üåÄ",
                            incorrect: "üõû Dica: qual roda rolaria sem saltitar?"
                        }
                    },
                    {
                        id: "q10",
                        statement: "Se voc√™ desenhar do centro de um c√≠rculo at√© a borda, como se chama essa linha?",
                        options: [
                            { id: "a", text: "üìè Di√¢metro" },
                            { id: "b", text: "üìê Raio" },
                            { id: "c", text: "üìä Lado" },
                            { id: "d", text: "üìà V√©rtice" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üìê RAIO DE GENIALIDADE! Do centro at√© a borda = raio c√≥smico! ‚≠ï‚ú®",
                            incorrect: "üéØ Dica: como um raio de sol do centro!"
                        }
                    },
                    {
                        id: "q11",
                        statement: "Quantos c√≠rculos voc√™ consegue ver em uma roda de bicicleta?",
                        options: [
                            { id: "a", text: "1 c√≠rculo" },
                            { id: "b", text: "2 c√≠rculos" },
                            { id: "c", text: "3 c√≠rculos" },
                            { id: "d", text: "Muitos c√≠rculos" }
                        ],
                        correct: "d",
                        feedback: {
                            correct: "üö≤ CICLISTA C√ìSMICO! Roda, pneu, raios‚Ä¶ c√≠rculos por toda parte! üåÄüåü",
                            incorrect: "üîÑ Dica: olhe bem‚Ä¶ tem c√≠rculos dentro de c√≠rculos!"
                        }
                    }
                ]
            },
            {
                id: 9,
                title: "Hex√°gono Hiperdrive ‚ö°",
                difficulty: "Avan√ßado",
                emoji: "‚¨°",
                color: "from-green-400 to-teal-500",
                description: "Domine a figura com 6 lados e libere o hiperdrive!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q7",
                        statement: "Quantos lados tem um hex√°gono?",
                        options: [
                            { id: "a", text: "4" },
                            { id: "b", text: "5" },
                            { id: "c", text: "6" },
                            { id: "d", text: "7" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "‚ö° Hiperdrive ativado! Hex√°gono = 6 lados! Sua nave acelera! üöÄüí´",
                            incorrect: "üî¢ 'Hexa' significa seis! Conte os lados com calma!"
                        }
                    },
                    {
                        id: "q8",
                        statement: "Onde voc√™ v√™ um hex√°gono na natureza?",
                        options: [
                            { id: "a", text: "üêù Colmeia de abelhas" },
                            { id: "b", text: "üå≥ Tronco de √°rvore" },
                            { id: "c", text: "üåä Onda do mar" },
                            { id: "d", text: "‚òÅÔ∏è Nuvem" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üçØ GENIAL! As abelhas s√£o arquitetas geom√©tricas! Constela√ß√£o final completa! üåüüåüüåü",
                            incorrect: "üêù Dica: quem faz favos perfeitos em forma de seis lados?"
                        }
                    },
                    {
                        id: "q12",
                        statement: "Uma moeda de 1 real tem quantos lados?",
                        options: [
                            { id: "a", text: "0 lados" },
                            { id: "b", text: "6 lados" },
                            { id: "c", text: "8 lados" },
                            { id: "d", text: "10 lados" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üí∞ RIQUEZA GEOM√âTRICA! Moedas s√£o redondas, sem lados! Hiperdrive financeiro! ‚ö°",
                            incorrect: "ü™ô Dica: moedas rolam porque s√£o redondas!"
                        }
                    },
                    {
                        id: "q13",
                        statement: "Se voc√™ unir 6 tri√¢ngulos iguais pelas pontas, que figura forma?",
                        options: [
                            { id: "a", text: "‚¨° Hex√°gono" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "‚≠ï C√≠rculo" },
                            { id: "d", text: "üî∏ Losango" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "‚ö° HEX√ÅGONO TURBINADO! 6 tri√¢ngulos = hiperdrive ativado! üöÄ‚¨°",
                            incorrect: "üî∫√ó6 Dica: seis lados unidos formam uma super figura!"
                        }
                    },
                    {
                        id: "q14",
                        statement: "Qual jogo usa um tabuleiro com c√©lulas hexagonais?",
                        options: [
                            { id: "a", text: "‚ôüÔ∏è Xadrez" },
                            { id: "b", text: "üéØ Damas" },
                            { id: "c", text: "‚¨° Settlers of Catan" },
                            { id: "d", text: "üé≤ Ludo" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üèùÔ∏è COLONO HEXAGONAL! Catan usa hex√°gonos para as ilhas! Hiperdrive final! ‚ö°‚¨°",
                            incorrect: "üé≤ Dica: jogo de estrat√©gia com ilhas de 6 lados!"
                        }
                    }
                ]
            },
            // Aventuras Esportivas
            {
                id: 10,
                title: "Futebol: O Campo de Batalha ‚öΩ",
                difficulty: "Intermedi√°rio",
                emoji: "‚öΩ",
                color: "from-green-400 to-emerald-500",
                description: "Descubra as formas escondidas no gramado!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q1",
                        statement: "Qual figura tem 4 lados iguais e 4 √¢ngulos retos, como o centro do campo?",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "‚úÖ PERFEITO! O centro do campo √© um quadrado! Torcida vibra! üéâüëè",
                            incorrect: "üü¢ Dica: pense em algo com todos os lados iguais e cantos em 90¬∞!"
                        }
                    },
                    {
                        id: "q2",
                        statement: "O gol tem formato parecido com qual figura?",
                        options: [
                            { id: "a", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "b", text: "‚¨° Hex√°gono" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "ü•Ö GOLA√áO GEOM√âTRICO! O gol √© um ret√¢ngulo! Vibra√ß√£o total! üîä",
                            incorrect: "ü•Ö Dica: tem dois lados longos e dois curtos‚Ä¶ igual √† trave!"
                        }
                    },
                    {
                        id: "q15",
                        statement: "A bola de futebol tem formato de qual figura geom√©trica?",
                        options: [
                            { id: "a", text: "üî∑ Quadrado" },
                            { id: "b", text: "üî∫ Tri√¢ngulo" },
                            { id: "c", text: "‚öΩ Esfera (3D do c√≠rculo)" },
                            { id: "d", text: "üî∏ Losango" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "‚öΩ CHUTE PERFEITO! A bola √© uma esfera, vers√£o 3D do c√≠rculo! GOOOOL! üéØ",
                            incorrect: "ü•Ö Dica: √© redonda como um c√≠rculo, mas em 3 dimens√µes!"
                        }
                    },
                    {
                        id: "q16",
                        statement: "Quantos lados tem o campo de futebol visto de cima?",
                        options: [
                            { id: "a", text: "3 lados" },
                            { id: "b", text: "4 lados" },
                            { id: "c", text: "5 lados" },
                            { id: "d", text: "6 lados" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üèüÔ∏è EST√ÅDIO GEOM√âTRICO! 4 lados fazem o ret√¢ngulo do campo! Torcida delira! üéâ",
                            incorrect: "‚öΩ Dica: como um ret√¢ngulo verde gigante!"
                        }
                    },
                    {
                        id: "q17",
                        statement: "A √°rea do goleiro (pequena √°rea) tem formato de:",
                        options: [
                            { id: "a", text: "‚≠ï C√≠rculo" },
                            { id: "b", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "‚¨° Hex√°gono" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üß§ DEFESA GEOM√âTRICA! √Årea pequena = ret√¢ngulo protetor! Goleiro her√≥i! üèÜ",
                            incorrect: "ü•Ö Dica: √© uma caixa retangular na frente do gol!"
                        }
                    }
                ]
            },
            {
                id: 11,
                title: "V√¥lei: No Ar com Estilo üèê",
                difficulty: "Intermedi√°rio",
                emoji: "üèê",
                color: "from-orange-400 to-red-500",
                description: "Ataque, bloqueio‚Ä¶ e muita geometria no saque!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q3",
                        statement: "A rede de v√¥lei √© feita de pequenos losangos ou‚Ä¶?",
                        options: [
                            { id: "a", text: "üî∑ Quadrados" },
                            { id: "b", text: "üî∫ Tri√¢ngulos" },
                            { id: "c", text: "üî∏ Losangos" },
                            { id: "d", text: "‚≠ï C√≠rculos" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üèê ACE! Isso mesmo, s√£o losangos! Rede perfeita! üåü",
                            incorrect: "üï∏Ô∏è Dica: forma de 'diamante' nas malhas da rede!"
                        }
                    },
                    {
                        id: "q4",
                        statement: "Quando o jogador levanta a bola, ela descreve um arco. Qual figura representa esse movimento?",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "c", text: "‚≠ï C√≠rculo" },
                            { id: "d", text: "‚ó° Semic√≠rculo" }
                        ],
                        correct: "d",
                        feedback: {
                            correct: "üåÄ LINDO LEVANTAMENTO! O arco √© um semic√≠rculo! ü§©",
                            incorrect: "üëÜ Dica: metade de um c√≠rculo‚Ä¶ como um sorriso no c√©u!"
                        }
                    },
                    {
                        id: "q18",
                        statement: "A quadra de v√¥lei vista de cima √© um:",
                        options: [
                            { id: "a", text: "üî∑ Quadrado" },
                            { id: "b", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üèê SAQUE ACE! A quadra √© um ret√¢ngulo dividido pela rede! Ponto! üåü",
                            incorrect: "üèê Dica: √© maior na largura que na altura!"
                        }
                    },
                    {
                        id: "q19",
                        statement: "Se a bola de v√¥lei fosse achatada, viraria um:",
                        options: [
                            { id: "a", text: "‚≠ï C√≠rculo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "üî∏ Losango" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üèê CORTADA PERFEITA! Bola achatada = c√≠rculo plano! Que jogada! ‚≠ï",
                            incorrect: "üèê Dica: imagine amassar uma bola redonda!"
                        }
                    },
                    {
                        id: "q20",
                        statement: "Quantas linhas retas delimitam uma quadra de v√¥lei?",
                        options: [
                            { id: "a", text: "2 linhas" },
                            { id: "b", text: "4 linhas" },
                            { id: "c", text: "6 linhas" },
                            { id: "d", text: "8 linhas" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üèê BLOQUEIO GEOM√âTRICO! 4 linhas formam o ret√¢ngulo da quadra! Defense! üõ°Ô∏è",
                            incorrect: "üìè Dica: conte as bordas de um ret√¢ngulo!"
                        }
                    }
                ]
            },
            {
                id: 12,
                title: "Capoeira: Dan√ßa com Simetria ü•ã",
                difficulty: "Avan√ßado",
                emoji: "ü¶µ",
                color: "from-yellow-400 to-orange-500",
                description: "Ginga, martelo‚Ä¶ e figuras no corpo em movimento!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q5",
                        statement: "Na posi√ß√£o de 'bananeira', o corpo forma qual figura?",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "‚ñ≠ Ret√¢ngulo" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üï∫ INCRED√çVEL! O corpo em V forma um tri√¢ngulo! Capoeira geom√©trica! üé∂",
                            incorrect: "üßò Dica: tr√™s pontos: duas m√£os e os p√©s no ar!"
                        }
                    },
                    {
                        id: "q6",
                        statement: "O roda de capoeira √© montada em formato circular. Quantos lados tem um c√≠rculo?",
                        options: [
                            { id: "a", text: "0" },
                            { id: "b", text: "1" },
                            { id: "c", text: "2" },
                            { id: "d", text: "Infinitos" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "üåÄ MESTRE DO C√çRCULO! C√≠rculo n√£o tem lados nem v√©rtices! Berimbau toca! ü™ò",
                            incorrect: "üé∂ Dica: rola, rola‚Ä¶ mas nunca tem pontas!"
                        }
                    },
                    {
                        id: "q21",
                        statement: "O movimento 'meia-lua' da capoeira desenha no ar um:",
                        options: [
                            { id: "a", text: "üî∑ Quadrado" },
                            { id: "b", text: "‚ó° Semic√≠rculo" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "‚ñ≠ Ret√¢ngulo" }
                        ],
                        correct: "b",
                        feedback: {
                            correct: "üåô MEIA-LUA PERFEITA! O p√© desenha um semic√≠rculo no ar! Ax√©! üé∂",
                            incorrect: "ü¶µ Dica: 'meia-lua' = metade de um c√≠rculo!"
                        }
                    },
                    {
                        id: "q22",
                        statement: "Quando dois capoeiristas fazem a 'ginga' um de frente para o outro, formam:",
                        options: [
                            { id: "a", text: "üìè Linhas paralelas" },
                            { id: "b", text: "üî∫ Tri√¢ngulo" },
                            { id: "c", text: "‚≠ï C√≠rculo imagin√°rio" },
                            { id: "d", text: "üî∑ Quadrado" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "üï∫ RODA SAGRADA! A ginga cria um c√≠rculo de energia invis√≠vel! Mandinga! ‚≠ï",
                            incorrect: "üé∂ Dica: a roda de capoeira √© sempre redonda!"
                        }
                    },
                    {
                        id: "q23",
                        statement: "O berimbau tem formato parecido com qual figura?",
                        options: [
                            { id: "a", text: "üèπ Arco (parte de c√≠rculo)" },
                            { id: "b", text: "üìè Linha reta" },
                            { id: "c", text: "üî∑ Quadrado" },
                            { id: "d", text: "üî∫ Tri√¢ngulo" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "ü™ò SOM GEOM√âTRICO! O berimbau √© curvado como um arco! Que toque! üéµ",
                            incorrect: "üé∂ Dica: √© curvado como um peda√ßo de c√≠rculo!"
                        }
                    }
                ]
            },
            {
                id: 13,
                title: "Pipa: No C√©u com Estilo ü™Å",
                difficulty: "Avan√ßado",
                emoji: "ü™Å",
                color: "from-purple-400 to-pink-500",
                description: "Altura, vento‚Ä¶ e figuras voando!",
                isQuizMode: true,
                questions: [
                    {
                        id: "q7",
                        statement: "A pipa tradicional tem formato de qual figura?",
                        options: [
                            { id: "a", text: "üî∫ Tri√¢ngulo" },
                            { id: "b", text: "üî∑ Quadrado" },
                            { id: "c", text: "üî∏ Losango" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "ü™Å VOANDO ALTO! A pipa √© um losango! Brilha no c√©u! ‚ú®",
                            incorrect: "üßµ Dica: quatro lados iguais, mas n√£o √© um quadrado‚Ä¶ √© mais 'pontudo'!"
                        }
                    },
                    {
                        id: "q8",
                        statement: "Se cortarmos uma pipa ao meio pela diagonal, obtemos duas figuras. Quais?",
                        options: [
                            { id: "a", text: "2 tri√¢ngulos" },
                            { id: "b", text: "2 quadrados" },
                            { id: "c", text: "2 ret√¢ngulos" },
                            { id: "d", text: "2 c√≠rculos" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "‚úÇÔ∏è GENIAL! Um losango cortado vira dois tri√¢ngulos! üéØ",
                            incorrect: "üìê Dica: toda divis√£o de losango por diagonal gera tri√¢ngulos!"
                        }
                    },
                    {
                        id: "q24",
                        statement: "A linha da pipa (rabiola) quando estica no vento forma uma:",
                        options: [
                            { id: "a", text: "üìè Linha reta" },
                            { id: "b", text: "üåä Linha curva" },
                            { id: "c", text: "üî∫ Tri√¢ngulo" },
                            { id: "d", text: "‚≠ï C√≠rculo" }
                        ],
                        correct: "a",
                        feedback: {
                            correct: "ü™Å VENTO PERFEITO! Linha esticada = reta geom√©trica no c√©u! Que altura! üìè",
                            incorrect: "üßµ Dica: quando estica bem, fica retinha!"
                        }
                    },
                    {
                        id: "q25",
                        statement: "Se voc√™ olhar uma pipa de frente, ela parece ter quantos 'cantos' (v√©rtices)?",
                        options: [
                            { id: "a", text: "2 cantos" },
                            { id: "b", text: "3 cantos" },
                            { id: "c", text: "4 cantos" },
                            { id: "d", text: "6 cantos" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "ü™Å PIPA PERFEITA! 4 cantos fazem o losango voador! Que espet√°culo! üî∏",
                            incorrect: "üî∏ Dica: conte as pontas do losango!"
                        }
                    },
                    {
                        id: "q26",
                        statement: "A sombra de uma pipa no ch√£o tem a mesma forma da pipa?",
                        options: [
                            { id: "a", text: "‚úÖ Sim, sempre" },
                            { id: "b", text: "‚ùå N√£o, nunca" },
                            { id: "c", text: "ü§î Depende da posi√ß√£o do sol" },
                            { id: "d", text: "üîÑ S√≥ quando gira" }
                        ],
                        correct: "c",
                        feedback: {
                            correct: "‚òÄÔ∏è SOMBRA GEOM√âTRICA! Depende do √¢ngulo do sol! Geometria e f√≠sica juntas! ü™Å",
                            incorrect: "üåÖ Dica: pense em como a sombra muda durante o dia!"
                        }
                    }
                ]
            }
        ];
        // ===================================================================================
        // --- FIM DA CONFIGURA√á√ÉO ---
        // ===================================================================================

        // --- SISTEMA DE FEEDBACK SONORO ---
        const SoundSystem = {
            play: (src) => {
                const audio = new Audio(src);
                    audio.play().catch(e => {});
                    audio.onended = () => {};
            },
            success: () => {
                const soundId = Math.floor(Math.random() * 3) + 1;
                SoundSystem.play(`../media/sons/feedback/acertos/acerto_${soundId}.mp3`);
            },
            error: () => {
                const soundId = Math.floor(Math.random() * 3) + 1;
                SoundSystem.play(`../media/sons/feedback/erros/erro_${soundId}.mp3`);
            },
            click: () => SoundSystem.play('../media/sons/feedback/click.mp3')
        };

        // --- COMPONENTES REACT ---

        const InitialScreen = ({ onStart, studentName, setStudentName, font, setFont }) => (
            <div className={`min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 flex items-center justify-center p-4 relative overflow-hidden`}>

                {/* Part√≠culas de fundo animadas */}
                <div className="absolute inset-0 pointer-events-none">
                    <div className="absolute top-20 left-20 text-6xl opacity-20 animate-bounce">‚≠ê</div>
                    <div className="absolute top-40 right-20 text-4xl opacity-30 animate-pulse">üåü</div>
                    <div className="absolute bottom-40 left-40 text-5xl opacity-15 animate-bounce" style={{animationDelay: '1s'}}>‚ú®</div>
                    <div className="absolute bottom-20 right-40 text-3xl opacity-25 animate-pulse" style={{animationDelay: '2s'}}>üöÄ</div>
                    <div className="absolute top-1/2 left-1/4 text-4xl opacity-20 animate-bounce" style={{animationDelay: '0.5s'}}>üî∫</div>
                    <div className="absolute top-1/3 right-1/3 text-3xl opacity-25 animate-pulse" style={{animationDelay: '1.5s'}}>‚≠ï</div>
                </div>

                <div className="bg-gradient-to-br from-white via-gray-50 to-white rounded-3xl shadow-2xl p-10 max-w-lg w-full transform transition-all duration-500 hover:scale-105 border-4 border-purple-200 relative z-10">
                    {/* Header √©pico */}
                    <div className="text-center mb-10">
                        <div className="relative mb-6">
                            <div className="bg-gradient-to-br from-yellow-300 via-orange-400 to-red-500 rounded-full p-6 shadow-2xl inline-block">
                                <div className="text-7xl animate-pulse">{activityConfig.emoji}</div>
                            </div>
                            <div className="absolute inset-0 bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 rounded-full opacity-30 animate-ping"></div>
                        </div>
                        <h1 className="text-4xl font-black text-gray-800 mb-4 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent">
                            {activityConfig.title}
                        </h1>
                        <div className="bg-gradient-to-r from-blue-100 via-purple-100 to-pink-100 rounded-2xl p-4 border-2 border-purple-200">
                            <p className="text-xl font-bold text-purple-800">üéØ Bem-vindo ao Mundo das Formas! üåü</p>
                            <p className="text-lg text-gray-700 mt-2">üéÆ Explore geometria em jogos, espa√ßo e esportes! üèÜ</p>
                        </div>
                    </div>

                    <div className="space-y-8">
                        {/* Input do nome com estilo √©pico */}
                        <div className="relative">
                            <label className="block text-xl font-black text-gray-800 mb-4 text-center">
                                <span className="text-3xl mr-2">üë®‚ÄçüöÄ</span>
                                Qual √© o nome do nosso explorador espacial?
                                <span className="text-3xl ml-2">üë©‚ÄçüöÄ</span>
                            </label>
                            <div className="relative">
                                <input
                                    type="text"
                                    className="w-full px-6 py-4 border-4 border-purple-300 rounded-2xl text-xl text-center focus:outline-none focus:border-purple-500 transition-all duration-300 font-bold bg-gradient-to-r from-blue-50 to-purple-50"
                                    placeholder="‚ú® Digite seu nome de astronauta ‚ú®"
                                    value={studentName}
                                    onChange={(e) => setStudentName(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && studentName.trim() && onStart(studentName)}
                                />
                                {studentName.trim() && (
                                    <div className="absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl animate-bounce">üöÄ</div>
                                )}
                            </div>
                        </div>

                        {/* Configura√ß√£o de fonte */}
                        <div className="bg-gradient-to-r from-gray-100 to-blue-100 rounded-2xl p-6 border-2 border-gray-300">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <span className="text-2xl">üî§</span>
                                    <span className="text-lg font-bold text-gray-800">Fonte para Dislexia:</span>
                                </div>
                                <button
                                    onClick={() => {
                                        const newFont = font === 'Comic Sans MS' ? 'OpenDyslexic' : 'Comic Sans MS';
                                        setFont(newFont);
                                        localStorage.setItem('selectedFont', newFont === 'OpenDyslexic' ? 'dyslexic' : 'normal');
                                    }}
                                    className={`px-6 py-3 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 ${font === 'OpenDyslexic' ? 'bg-green-500 text-white shadow-lg' : 'bg-gray-300 text-gray-700'}`}
                                >
                                    {font === 'OpenDyslexic' ? '‚úÖ Ativada' : '‚ö™ Desativada'}
                                </button>
                            </div>
                        </div>

                        {/* Bot√µes √©picos */}
                        <div className="space-y-4">
                            <button
                                onClick={() => onStart(studentName)}
                                disabled={!studentName.trim()}
                                className={`w-full bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 text-white font-black py-5 rounded-2xl text-2xl transition-all duration-300 hover:shadow-2xl transform hover:scale-105 border-2 border-white/30 relative overflow-hidden group ${!studentName.trim() ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <span className="relative z-10 flex items-center justify-center gap-3">
                                    <span className="text-3xl animate-pulse">üéÆ</span>
                                    INICIAR AVENTURA GEOM√âTRICA
                                    <span className="text-3xl animate-bounce">üåü</span>
                                </span>
                                {studentName.trim() && (
                                    <div className="absolute inset-0 bg-white/10 group-hover:bg-white/20 transition-all animate-pulse"></div>
                                )}
                            </button>

                            <button
                                onClick={() => window.location.href = '../index.html'}
                                className="w-full bg-gradient-to-r from-gray-500 via-gray-600 to-gray-700 text-white font-black py-4 rounded-2xl text-lg transition-all duration-300 hover:shadow-2xl transform hover:scale-105 border-2 border-white/30 relative overflow-hidden group"
                            >
                                <span className="relative z-10 flex items-center justify-center gap-3">
                                    <span className="text-2xl animate-pulse">üè†</span>
                                    VOLTAR AO PORTAL PRINCIPAL
                                    <span className="text-2xl animate-bounce">üåå</span>
                                </span>
                                <div className="absolute inset-0 bg-white/10 group-hover:bg-white/20 transition-all"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        );

        const BlockSelectionScreen = ({ studentName, onSelectBlock, onFinishSession }) => {
            const [hoveredBlock, setHoveredBlock] = useState(null);

            const groupedLevels = {};
            activityBlocks.forEach(block => {
                if (!groupedLevels[block.difficulty]) groupedLevels[block.difficulty] = [];
                groupedLevels[block.difficulty].push(block);
            });

            return (
                <div className={`min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 p-4`}>

                    {/* Header com anima√ß√£o de part√≠culas */}
                    <div className="max-w-7xl mx-auto relative">
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            <div className="absolute top-10 left-10 text-6xl opacity-30 animate-bounce">‚≠ê</div>
                            <div className="absolute top-20 right-20 text-4xl opacity-40 animate-pulse">üåü</div>
                            <div className="absolute bottom-20 left-20 text-5xl opacity-20 animate-bounce" style={{animationDelay: '1s'}}>‚ú®</div>
                            <div className="absolute top-40 right-40 text-3xl opacity-30 animate-pulse" style={{animationDelay: '2s'}}>üöÄ</div>
                        </div>

                        <div className="text-center mb-12 relative z-10">
                            <div className="inline-block mb-6">
                                <div className="bg-gradient-to-br from-yellow-300 via-orange-400 to-red-500 rounded-full p-8 shadow-2xl transform animate-pulse">
                                    <div className="text-8xl">üåå</div>
                                </div>
                            </div>
                            <h1 className="text-6xl font-bold text-white mb-4 drop-shadow-2xl">üéâ Ol√°, {studentName}! üéâ</h1>
                            <p className="text-3xl text-yellow-200 font-bold mb-2">Bem-vindo ao Mundo das Formas Geom√©tricas!</p>
                            <p className="text-xl text-white opacity-90">‚ú® Explore formas em jogos, no espa√ßo e nos esportes! ‚ú®</p>
                        </div>
                        
                        {Object.entries(groupedLevels).map(([levelName, blocksInLevel]) => (
                            <div key={levelName} className="mb-16 relative">
                                {/* Header da se√ß√£o com efeito neon */}
                                <div className="bg-black/30 backdrop-blur-sm rounded-3xl p-8 mb-10 border-4 border-white/20 shadow-2xl">
                                    <h2 className="text-5xl font-bold text-center text-white mb-4 drop-shadow-2xl">
                                        <span className="inline-block mr-4 animate-bounce">
                                            {levelName === 'Iniciante' && 'üå±'}
                                            {levelName === 'Intermedi√°rio' && '‚ö°'}
                                            {levelName === 'Avan√ßado' && 'üî•'}
                                        </span>
                                        <span className="bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 bg-clip-text text-transparent">
                                            {levelName === 'Iniciante' && 'AVENTUREIRO DAS FORMAS'}
                                            {levelName === 'Intermedi√°rio' && 'MESTRE DA GEOMETRIA'}
                                            {levelName === 'Avan√ßado' && 'LENDA GEOM√âTRICA'}
                                        </span>
                                    </h2>
                                    <p className="text-center text-xl text-cyan-200 font-bold">
                                        {levelName === 'Iniciante' && 'üéÆ Explore formas em jogos, espa√ßo e esportes!'}
                                        {levelName === 'Intermedi√°rio' && 'üèÜ Domine desafios em m√∫ltiplos universos!'}
                                        {levelName === 'Avan√ßado' && 'üëë Conquiste todos os mundos geom√©tricos!'}
                                    </p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                    {blocksInLevel.map((block, index) => (
                                        <div
                                            key={block.id}
                                            className="relative bg-gradient-to-br from-white via-gray-50 to-white rounded-3xl shadow-2xl p-8 transform transition-all duration-500 hover:scale-110 hover:shadow-3xl cursor-pointer group overflow-hidden border-4 border-transparent hover:border-yellow-300"
                                            onClick={() => {
                                                SoundSystem.click();
                                                onSelectBlock(block);
                                            }}
                                            onMouseEnter={() => setHoveredBlock(block.id)}
                                            onMouseLeave={() => setHoveredBlock(null)}
                                            style={{animationDelay: `${index * 0.2}s`}}
                                        >
                                            {/* Efeito de part√≠culas de fundo */}
                                            <div className="absolute inset-0 opacity-10 group-hover:opacity-20 transition-opacity">
                                                <div className="absolute top-2 right-2 text-2xl animate-pulse">‚ú®</div>
                                                <div className="absolute bottom-2 left-2 text-xl animate-bounce">‚≠ê</div>
                                                <div className="absolute top-1/2 right-1/4 text-lg animate-pulse" style={{animationDelay: '1s'}}>üåü</div>
                                            </div>

                                            <div className="text-center relative z-10">
                                                {/* Emoji com efeito especial */}
                                                <div className="relative mb-6">
                                                    <div className={`text-8xl mb-2 transform transition-all duration-500 ${hoveredBlock === block.id ? 'scale-125 animate-bounce' : 'group-hover:scale-110'}`}>
                                                        {block.emoji}
                                                    </div>
                                                    {hoveredBlock === block.id && (
                                                        <div className="absolute inset-0 bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 rounded-full opacity-30 animate-ping"></div>
                                                    )}
                                                </div>

                                                {/* T√≠tulo com gradiente animado */}
                                                <h3 className={`text-2xl font-black mb-4 bg-gradient-to-r ${block.color} bg-clip-text text-transparent transform transition-all duration-300 group-hover:scale-105`}>
                                                    {block.title}
                                                </h3>

                                                <p className="text-gray-700 mb-6 text-lg font-semibold leading-relaxed">{block.description}</p>

                                                {/* Info box com efeito neon */}
                                                <div className="bg-gradient-to-r from-blue-100 via-purple-100 to-pink-100 rounded-2xl p-6 mb-6 border-2 border-purple-200 group-hover:border-purple-400 transition-all">
                                                    {block.isQuizMode ? (
                                                        <div className="flex items-center justify-center gap-2">
                                                            <span className="text-2xl">üåå</span>
                                                            <p className="text-lg font-bold text-purple-800">{block.questions.length} Quest√µes Gal√°cticas</p>
                                                        </div>
                                                    ) : (
                                                        <div className="flex items-center justify-center gap-2">
                                                            <span className="text-2xl">üéØ</span>
                                                            <p className="text-lg font-bold text-blue-800">{block.challenge.targets.length} Figuras para Dominar</p>
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Bot√£o com efeito especial */}
                                                <button className={`w-full bg-gradient-to-r ${block.color} text-white font-black py-5 rounded-2xl text-xl transition-all duration-300 hover:shadow-2xl group-hover:scale-105 transform relative overflow-hidden border-2 border-white/30`}>
                                                    <span className="relative z-10 flex items-center justify-center gap-3">
                                                        <span className="text-2xl animate-pulse">üöÄ</span>
                                                        INICIAR MISS√ÉO
                                                        <span className="text-2xl animate-bounce">‚≠ê</span>
                                                    </span>
                                                    {hoveredBlock === block.id && (
                                                        <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
                                                    )}
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}

                        {/* Footer √©pico */}
                        <div className="bg-gradient-to-br from-black/40 via-purple-900/40 to-black/40 backdrop-blur-lg rounded-3xl p-10 border-4 border-white/20 shadow-2xl">
                            <div className="text-center mb-6">
                                <div className="text-6xl mb-4">üéØ</div>
                                <h3 className="text-3xl font-bold text-white mb-2">Centro de Controle Geom√©trico</h3>
                                <p className="text-lg text-cyan-200">Gerencie sua jornada pelos mundos das figuras geom√©tricas</p>
                            </div>

                            <div className="flex flex-col md:flex-row gap-6 justify-center">
                                <button
                                    onClick={onFinishSession}
                                    className="bg-gradient-to-r from-green-400 via-green-500 to-green-600 text-white font-black py-5 px-10 rounded-2xl text-xl transition-all duration-300 hover:shadow-2xl transform hover:scale-105 border-2 border-white/30 relative overflow-hidden group"
                                >
                                    <span className="relative z-10 flex items-center justify-center gap-3">
                                        <span className="text-2xl animate-pulse">üíæ</span>
                                        RELAT√ìRIO DA MISS√ÉO
                                        <span className="text-2xl animate-bounce">üìä</span>
                                    </span>
                                    <div className="absolute inset-0 bg-white/10 group-hover:bg-white/20 transition-all"></div>
                                </button>

                                <button
                                    onClick={() => window.location.href = '../index.html'}
                                    className="bg-gradient-to-r from-gray-500 via-gray-600 to-gray-700 text-white font-black py-5 px-10 rounded-2xl text-xl transition-all duration-300 hover:shadow-2xl transform hover:scale-105 border-2 border-white/30 relative overflow-hidden group"
                                >
                                    <span className="relative z-10 flex items-center justify-center gap-3">
                                        <span className="text-2xl animate-pulse">üöÄ</span>
                                        PORTAL PRINCIPAL
                                        <span className="text-2xl animate-bounce">üè†</span>
                                    </span>
                                    <div className="absolute inset-0 bg-white/10 group-hover:bg-white/20 transition-all"></div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const BlockCompletePopup = ({ stats, onContinue }) => (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 celebration-popup">
                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full text-center transform transition-all duration-500 scale-100">
                    <div className="text-8xl mb-4">üéâ</div>
                    <h2 className="text-4xl font-bold text-gray-800 mb-3">Aventura Conclu√≠da!</h2>
                    <p className="text-gray-600 text-lg mb-6">Voc√™ √© um mestre construtor! Veja seu desempenho:</p>
                    <div className="grid grid-cols-3 gap-4 bg-gray-100 rounded-xl p-6 mb-8 text-center">
                        <div>
                            <div className="text-4xl font-bold text-blue-500">{stats.timeSpent}s</div>
                            <div className="text-sm text-gray-600">Tempo</div>
                        </div>
                        <div>
                            <div className="text-4xl font-bold text-green-500">{stats.acertos}</div>
                            <div className="text-sm text-gray-600">Acertos</div>
                        </div>
                        <div>
                            <div className="text-4xl font-bold text-red-500">{stats.erros}</div>
                            <div className="text-sm text-gray-600">Erros</div>
                        </div>
                    </div>
                    <button
                        onClick={onContinue}
                        className="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white font-bold py-4 rounded-xl text-xl transition-all duration-300 hover:shadow-lg transform hover:scale-105"
                    >
                        Continuar Jornada üöÄ
                    </button>
                </div>
            </div>
        );

        // Componente para Quiz de m√∫ltipla escolha
        const QuizScreen = ({ block, onBack, onComplete }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0)
            const [answers, setAnswers] = useState({})
            const [showFeedback, setShowFeedback] = useState(false)
            const [feedbackMessage, setFeedbackMessage] = useState('')
            const [isCorrectAnswer, setIsCorrectAnswer] = useState(false)
            const [startTime] = useState(Date.now())
            const [totalCorrect, setTotalCorrect] = useState(0)
            const [showBlockCompletePopup, setShowBlockCompletePopup] = useState(false)
            const [blockStats, setBlockStats] = useState(null)
            const [showSpectacularCelebration, setShowSpectacularCelebration] = useState(false)

            const currentQuestion = block.questions[currentQuestionIndex]
            const isLastQuestion = currentQuestionIndex === block.questions.length - 1

            const handleAnswerSelect = (optionId) => {
                if (showFeedback) return

                const isCorrect = optionId === currentQuestion.correct
                setIsCorrectAnswer(isCorrect)
                setAnswers(prev => ({ ...prev, [currentQuestion.id]: { selected: optionId, correct: isCorrect } }))

                if (isCorrect) {
                    SoundSystem.success()
                    setTotalCorrect(prev => prev + 1)
                    setFeedbackMessage(currentQuestion.feedback.correct)
                    setShowSpectacularCelebration(true)
                    setTimeout(() => setShowSpectacularCelebration(false), 2000)
                } else {
                    SoundSystem.error()
                    setFeedbackMessage(currentQuestion.feedback.incorrect)
                }

                setShowFeedback(true)

                setTimeout(() => {
                    if (isLastQuestion) {
                        const timeSpent = Math.round((Date.now() - startTime) / 1000)
                        const stats = {
                            block,
                            questionId: 'quiz_complete',
                            timeSpent,
                            acertos: totalCorrect + (isCorrect ? 1 : 0),
                            erros: block.questions.length - (totalCorrect + (isCorrect ? 1 : 0)),
                            score: Math.round(((totalCorrect + (isCorrect ? 1 : 0)) / block.questions.length) * 100)
                        }
                        onComplete(stats)
                        setBlockStats(stats)
                        setShowBlockCompletePopup(true)
                    } else {
                        setCurrentQuestionIndex(prev => prev + 1)
                        setShowFeedback(false)
                    }
                }, 3000)
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 p-4">
                    {showSpectacularCelebration && (
                        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 celebration-popup">
                            <div className="bg-gradient-to-br from-yellow-300 via-orange-400 to-red-500 rounded-3xl p-12 text-center max-w-2xl mx-4 shadow-2xl border-4 border-white transform animate-bounce">
                                <div className="text-8xl mb-6">üéâüåü‚ú®</div>
                                <h2 className="text-6xl font-bold text-white mb-4 drop-shadow-lg">INCR√çVEL!</h2>
                                <div className="text-4xl mb-4">üöÄüåå‚≠ê</div>
                                <p className="text-2xl text-white font-bold drop-shadow">Voc√™ est√° dominando o universo das formas!</p>
                            </div>
                        </div>
                    )}
                    {showBlockCompletePopup && <BlockCompletePopup stats={blockStats} onContinue={onBack} />}

                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 mb-8">
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h1 className="text-4xl font-bold text-gray-800 mb-2">{block.emoji} {block.title}</h1>
                                    <p className="text-xl text-gray-600">{block.description}</p>
                                </div>
                                <button onClick={onBack} className="bg-gray-500 text-white px-6 py-3 rounded-xl hover:bg-gray-600 text-lg font-bold">‚¨ÖÔ∏è Voltar</button>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-6 mb-4">
                                <div className={`bg-gradient-to-r ${block.color} h-6 rounded-full transition-all duration-500 flex items-center justify-center`} style={{ width: `${((currentQuestionIndex + 1) / block.questions.length) * 100}%` }}>
                                    <span className="text-white font-bold text-sm">üöÄ</span>
                                </div>
                            </div>
                            <div className="text-center font-bold text-gray-700 text-xl">
                                üåü Progresso Gal√°ctico: {currentQuestionIndex + 1} de {block.questions.length} | Acertos: {totalCorrect} ‚≠ê
                            </div>
                        </div>

                        <div className="bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 rounded-3xl shadow-xl p-8 mb-6 border-4 border-purple-300">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">{currentQuestion.id.includes('1') || currentQuestion.id.includes('2') ? 'üõ∏' : currentQuestion.id.includes('3') || currentQuestion.id.includes('4') ? 'üíé' : currentQuestion.id.includes('5') || currentQuestion.id.includes('6') ? 'üåï' : '‚ö°'}</div>
                                <h2 className="text-3xl font-bold text-gray-800 mb-4">{currentQuestion.statement}</h2>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                {currentQuestion.options.map((option) => (
                                    <button
                                        key={option.id}
                                        onClick={() => handleAnswerSelect(option.id)}
                                        disabled={showFeedback}
                                        className={`p-6 rounded-2xl border-4 text-2xl font-bold transition-all duration-300 transform hover:scale-105 ${
                                            showFeedback
                                                ? option.id === currentQuestion.correct
                                                    ? 'bg-green-200 border-green-500 correct-answer-animation'
                                                    : answers[currentQuestion.id]?.selected === option.id
                                                    ? 'bg-red-200 border-red-500 wrong-answer-animation'
                                                    : 'bg-gray-100 border-gray-300'
                                                : 'bg-white border-purple-300 hover:border-purple-500 hover:bg-purple-50 cursor-pointer'
                                        }`}
                                    >
                                        <div className="text-4xl mb-2">{option.text.split(' ')[0]}</div>
                                        <div className="text-lg">{option.text.split(' ').slice(1).join(' ')}</div>
                                    </button>
                                ))}
                            </div>

                            {showFeedback && (
                                <div className={`text-center p-6 rounded-2xl text-2xl font-bold ${isCorrectAnswer ? 'bg-green-200 text-green-800' : 'bg-blue-200 text-blue-800'} border-4 ${isCorrectAnswer ? 'border-green-500' : 'border-blue-500'}`}>
                                    <div className="text-4xl mb-2">{isCorrectAnswer ? 'üéâ' : 'üí°'}</div>
                                    {feedbackMessage}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            )
        }

        const ActivityScreen = ({ block, onBack, onComplete }) => {
            // Se o bloco tem quest√µes (√© um quiz), usar o QuizScreen
            if (block.isQuizMode && block.questions) {
                return <QuizScreen block={block} onBack={onBack} onComplete={onComplete} />
            }

            // Caso contr√°rio, usar o sistema de arrastar e soltar original
            const [targets, setTargets] = useState(block.challenge.targets.map(t => ({ ...t, isCorrect: false, droppedShape: null })))
            const [figures, setFigures] = useState([...block.challenge.figures].sort(() => Math.random() - 0.5))
            const [draggedItem, setDraggedItem] = useState(null)
            const [startTime, setStartTime] = useState(Date.now())
            const [errors, setErrors] = useState(0)
            const [showCelebration, setShowCelebration] = useState(false)
            const [isCompleted, setIsCompleted] = useState(false)
            const [showBlockCompletePopup, setShowBlockCompletePopup] = useState(false)
            const [blockStats, setBlockStats] = useState(null)

            const correctCount = targets.filter(t => t.isCorrect).length
            const totalCount = targets.length

            const handleDragStart = (e, figure) => {
                setDraggedItem(figure)
                e.dataTransfer.effectAllowed = 'move'
            }

            const handleDragOver = (e) => {
                e.preventDefault()
                e.dataTransfer.dropEffect = 'move'
            }

            const handleDrop = (e, targetId) => {
                e.preventDefault()
                if (!draggedItem) return

                const target = targets.find(t => t.id === targetId)
                if (target.isCorrect) return

                const isCorrect = target.shape === draggedItem
                SoundSystem.click()

                if (isCorrect) {
                    SoundSystem.success()
                    setShowCelebration(true)
                    setTimeout(() => setShowCelebration(false), 1500)
                    setTargets(prev => prev.map(t => 
                        t.id === targetId ? { ...t, isCorrect: true, droppedShape: draggedItem } : t
                    ))
                    setFigures(prev => prev.filter(f => f !== draggedItem))
                } else {
                    SoundSystem.error()
                    setErrors(prev => prev + 1)
                }
                setDraggedItem(null)
            }

            useEffect(() => {
                if (!isCompleted && correctCount === totalCount && totalCount > 0) {
                    setIsCompleted(true)
                    const timeSpent = Math.round((Date.now() - startTime) / 1000)
                    const stats = {
                        block,
                        questionId: block.challenge.id,
                        timeSpent,
                        acertos: totalCount,
                        erros: errors,
                        score: Math.round((totalCount / (totalCount + errors)) * 100)
                    }
                    onComplete(stats)
                    setBlockStats(stats)
                    setShowBlockCompletePopup(true)
                }
            }, [correctCount, totalCount, isCompleted, startTime, onComplete, block, errors])

            return (
                <div className={`min-h-screen bg-gradient-to-br from-blue-400 via-purple-400 to-pink-400 p-4`}>
                    {showCelebration && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 celebration-popup">
                            <div className="bg-white rounded-lg p-8 text-center max-w-md mx-4">
                                <div className="text-4xl mb-4">üéâ</div>
                                <p className="text-2xl font-bold text-green-600 mb-4">Correto!</p>
                            </div>
                        </div>
                    )}
                    {showBlockCompletePopup && <BlockCompletePopup stats={blockStats} onContinue={onBack} />}
                    
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-2xl font-bold text-gray-800">{block.emoji} {block.title}</h1>
                                <button onClick={onBack} className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">‚¨ÖÔ∏è Voltar</button>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                                <div className={`bg-gradient-to-r ${block.color} h-4 rounded-full transition-all duration-500`} style={{ width: `${(correctCount / totalCount) * 100}%` }}></div>
                            </div>
                            <div className="text-center font-bold text-gray-700 mt-2">
                                üìä Progresso: {correctCount} de {totalCount} | Erros: {errors}
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-8">
                            <div className="bg-white/90 backdrop-blur-sm rounded-lg p-6 border-2 border-blue-200">
                                <h3 className="text-2xl font-bold mb-4 text-center">Figuras para Arrastar</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    {figures.map((figure, index) => (
                                        <div
                                            key={index}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, figure)}
                                            className="bg-yellow-200 border-2 border-yellow-400 rounded-lg p-4 text-center cursor-move hover:bg-yellow-300 transition duration-300 text-xl font-bold"
                                        >
                                            {figure}
                                        </div>
                                    ))}
                                </div>
                            </div>
                          
                            <div className="bg-white/90 backdrop-blur-sm rounded-lg p-6 border-2 border-green-200">
                                <h3 className="text-2xl font-bold mb-4 text-center">Onde Colocar</h3>
                                <div className="space-y-4">
                                    {targets.map((target) => (
                                        <div
                                            key={target.id}
                                            onDragOver={handleDragOver}
                                            onDrop={(e) => handleDrop(e, target.id)}
                                            className={`min-h-[4rem] p-4 border-2 rounded-lg text-center transition duration-300 flex items-center justify-center ${ 
                                                target.isCorrect 
                                                    ? 'bg-green-200 border-green-500 correct-answer-animation' 
                                                    : 'bg-gray-100 border-dashed border-gray-400 hover:bg-gray-200'
                                            }`}
                                        >
                                            {target.isCorrect ? (
                                                <div className="text-green-800 font-bold text-xl">
                                                    ‚úì {target.emoji} {target.name} - {target.droppedShape}
                                                </div>
                                            ) : (
                                                <div className="text-gray-700 text-xl">
                                                   {target.emoji} {target.name}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            )
        }

        const AtividadeTemplate = () => {
            const [studentName, setStudentName] = useState(localStorage.getItem('studentName') || '')
            const [font, setFont] = useState(localStorage.getItem('selectedFont') === 'dyslexic' ? 'OpenDyslexic' : 'Comic Sans MS')
            const [currentScreen, setCurrentScreen] = useState('initial')
            const [selectedBlock, setSelectedBlock] = useState(null)
            const [sessionResults, setSessionResults] = useState([])

            useEffect(() => {
                document.title = activityConfig.title
                document.body.className = font === 'OpenDyslexic' ? 'font-dyslexic' : ''
            }, [font])

            const handleStart = (name) => {
                if (name.trim()) {
                    setStudentName(name)
                    localStorage.setItem('studentName', name)
                    setCurrentScreen('blockSelection')
                }
            }

            const handleSelectBlock = (block) => {
                setSelectedBlock(block)
                setCurrentScreen('activity')
            }
            
            const handleCompleteBlock = (result) => {
                // Determinar o total de quest√µes baseado no tipo de bloco
                const totalQuestions = result.block.isQuizMode
                    ? result.block.questions.length
                    : result.block.challenge.targets.length;

                const newResult = {
                    Nome: studentName,
                    Materia: activityConfig.subject,
                    Atividade: activityConfig.activity,
                    Bloco: result.block.title,
                    Questao: `${result.acertos}_de_${totalQuestions}`,
                    Tempo_Execucao: result.timeSpent + 's',
                    Acertos: result.acertos,
                    Erros: result.erros,
                    Score: result.score + '%'
                }
                setSessionResults(prev => [...prev, newResult])
            }

            const handleFinishSession = () => {
                if (sessionResults.length === 0) {
                    alert("Nenhuma atividade foi completada para gerar o relat√≥rio.")
                    return
                }
                
                const header = 'Nome,Materia,Atividade,Bloco,Questao,Tempo_Execucao,Acertos,Erros,Score\n'
                const csvContent = sessionResults.map(r => Object.values(r).join(',')).join('\n')
                const fullContent = header + csvContent
                
                const blob = new Blob([fullContent], { type: 'text/csv;charset=utf-8;' })
                const link = document.createElement('a')
                const url = URL.createObjectURL(blob)
                link.href = url
                
                const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')
                const studentNameForFile = studentName.replace(/[^a-zA-Z0-9]/g, '_')
                link.download = `${activityConfig.activity}_${studentNameForFile}_${dateStr}.csv`
                
                document.body.appendChild(link)
                link.click()
                document.body.removeChild(link)
                URL.revokeObjectURL(url)

                alert(`üéâ Dados exportados com sucesso!`);
            }

            switch (currentScreen) {
                case 'initial':
                    return <InitialScreen onStart={handleStart} studentName={studentName} setStudentName={setStudentName} font={font} setFont={setFont} />
                case 'blockSelection':
                    return <BlockSelectionScreen studentName={studentName} onSelectBlock={handleSelectBlock} onFinishSession={handleFinishSession} />
                case 'activity':
                    return <ActivityScreen block={selectedBlock} onBack={() => setCurrentScreen('blockSelection')} onComplete={handleCompleteBlock} />
                default:
                    return <InitialScreen onStart={handleStart} studentName={studentName} setStudentName={setStudentName} font={font} setFont={setFont} />
            }
        };

        ReactDOM.render(<AtividadeTemplate />, document.getElementById('root'));
    </script>
</body>
</html>
