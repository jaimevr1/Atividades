<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fazenda de Mobs</title>
    <link href="https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Sans+MS:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'OpenDyslexic', 'Comic Sans MS', cursive, sans-serif;
        }
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            Carregando Atividade...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const FazendaMobs = () => {
            const [studentName, setStudentName] = useState('');
            const [selectedFont, setSelectedFont] = useState(localStorage.getItem('selectedFont') || 'comic');
            const [currentPhase, setCurrentPhase] = useState('inicio');
            const [currentBlock, setCurrentBlock] = useState(null);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [sessionResults, setSessionResults] = useState([]);
            const [startTime, setStartTime] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [showFeedback, setShowFeedback] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [score, setScore] = useState(0);

            const questionsBlocks = {
                1: { // 6-7 anos - Multiplica√ß√£o b√°sica at√© 4x, produtos at√© 20
                  title: "üéÆ Novato no Roblox - Primeiros Passos",
                  ageRange: "6-7 anos",
                  questions: [
                    {
                      scenario: "Voc√™ acabou de entrar no Roblox! Seu avatar precisa de roupas novas. Voc√™ encontrou 3 lojas, cada uma vendendo 2 camisetas legais. Quantas camisetas diferentes voc√™ pode escolher no total?",
                      visual: "üè™[üëïüëï] üè™[üëïüëï] üè™[üëïüëï]",
                      calculation: "2 + 2 + 2",
                      answer: 6,
                      multiplication: "3 √ó 2",
                      hint: "Conte as camisetas de cada loja e some tudo!",
                      context: "Customiza√ß√£o de avatar - conceito fundamental do Roblox"
                    },
                    {
                      scenario: "No jogo 'Pet Simulator', voc√™ ganhou 4 ovos especiais. Cada ovo sempre d√° exatamente 3 pets quando quebra. Se voc√™ quebrar todos os ovos, quantos pets novos voc√™ ter√°?",
                      visual: "ü•ö[üê±üê∂üê∞] ü•ö[üê±üê∂üê∞] ü•ö[üê±üê∂üê∞] ü•ö[üê±üê∂üê∞]",
                      calculation: "3 + 3 + 3 + 3",
                      answer: 12,
                      multiplication: "4 √ó 3",
                      hint: "Cada ovo sempre d√° 3 pets. Conte todos!",
                      context: "Pet games s√£o muito populares entre crian√ßas pequenas"
                    },
                    {
                      scenario: "Voc√™ est√° jogando 'Obby Escape' e chegou numa sala com 5 plataformas. Em cada plataforma h√° exatamente 2 moedas brilhantes para coletar. Quantas moedas voc√™ conseguir√° pegar nesta sala?",
                      visual: "‚¨ú[ü™ôü™ô] ‚¨ú[ü™ôü™ô] ‚¨ú[ü™ôü™ô] ‚¨ú[ü™ôü™ô] ‚¨ú[ü™ôü™ô]",
                      calculation: "2 + 2 + 2 + 2 + 2",
                      answer: 10,
                      multiplication: "5 √ó 2",
                      hint: "Cada plataforma tem 2 moedas. Some todas!",
                      context: "Obbys s√£o obstacle courses muito jogados por crian√ßas"
                    },
                    {
                      scenario: "No 'Tycoon dos Dinossauros', voc√™ construiu 2 cercados gigantes. Cada cercado abriga exatamente 4 dinossauros beb√™s. Quantos dinossauros beb√™s voc√™ est√° cuidando no total?",
                      visual: "ü¶ïü¶ïü¶ïü¶ï | ü¶ïü¶ïü¶ïü¶ï",
                      calculation: "4 + 4",
                      answer: 8,
                      multiplication: "2 √ó 4",
                      hint: "Conte os dinossauros de cada cercado!",
                      context: "Tycoons ensinam gest√£o de recursos de forma l√∫dica"
                    },
                    {
                      scenario: "Voc√™ est√° no 'Pizza Place' trabalhando como entregador. Voc√™ fez 3 viagens de entrega hoje. Em cada viagem, voc√™ entregou exatamente 5 pizzas quentinhas. Quantas pizzas voc√™ entregou no dia todo?",
                      visual: "üöó[üçïüçïüçïüçïüçï] üöó[üçïüçïüçïüçïüçï] üöó[üçïüçïüçïüçïüçï]",
                      calculation: "5 + 5 + 5",
                      answer: 15,
                      multiplication: "3 √ó 5",
                      hint: "Some as pizzas de todas as suas viagens!",
                      context: "Roleplay games ajudam a entender profiss√µes"
                    }
                  ]
                },
                2: { // 8-9 anos - Multiplica√ß√£o at√© 8x, produtos at√© 60
                  title: "‚öîÔ∏è Aventureiro Experiente - Desafios Maiores",
                  ageRange: "8-9 anos", 
                  questions: [
                    {
                      scenario: "No 'Simulator de Minera√ß√£o Espacial', voc√™ descobriu um asteroide raro com 7 pontos de escava√ß√£o. Cada ponto sempre rende exatamente 6 cristais preciosos quando minerado completamente. Se voc√™ minerar todo o asteroide, quantos cristais ter√° coletado?",
                      visual: "‚òÑÔ∏è ‚Üí ‚õèÔ∏è[üíéüíéüíéüíéüíéüíé] √ó 7 pontos",
                      calculation: "6 + 6 + 6 + 6 + 6 + 6 + 6",
                      answer: 42,
                      multiplication: "7 √ó 6",
                      hint: "Cada ponto de escava√ß√£o rende 6 cristais. Multiplique!",
                      context: "Simulators espaciais estimulam interesse por ci√™ncias"
                    },
                    {
                      scenario: "Voc√™ √© dono de uma loja de carros no 'Vehicle Simulator'. Hoje chegaram 6 caminh√µes de entrega, cada um trazendo exatamente 8 carros novos para sua loja. Quantos carros novos voc√™ recebeu para vender?",
                      visual: "üöõ[üöóüöóüöóüöóüöóüöóüöóüöó] √ó 6 caminh√µes",
                      calculation: "8 + 8 + 8 + 8 + 8 + 8",
                      answer: 48,
                      multiplication: "6 √ó 8",
                      hint: "Cada caminh√£o trouxe 8 carros. Calcule o total!",
                      context: "Vehicle simulators trabalham conceitos de neg√≥cios"
                    },
                    {
                      scenario: "No 'Torre de Batalha', voc√™ formou uma guilda com 8 membros (incluindo voc√™). Cada membro da guilda ganhou exatamente 7 pontos de experi√™ncia na √∫ltima miss√£o. Quantos pontos de experi√™ncia sua guilda ganhou no total?",
                      visual: "üë•[‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê] √ó 8 membros",
                      calculation: "7 + 7 + 7 + 7 + 7 + 7 + 7 + 7",
                      answer: 56,
                      multiplication: "8 √ó 7",
                      hint: "Cada membro ganhou 7 pontos. Multiplique pelo n√∫mero de membros!",
                      context: "Guilds ensinam trabalho em equipe e colabora√ß√£o"
                    },
                    {
                      scenario: "Voc√™ trabalha no 'Restaurante Cinco Estrelas' como chef. Para o jantar especial de hoje, voc√™ precisa preparar 9 mesas VIP. Cada mesa VIP sempre serve exatamente 5 pratos principais. Quantos pratos principais voc√™ precisa cozinhar?",
                      visual: "üçΩÔ∏è[ü•òü•òü•òü•òü•ò] √ó 9 mesas VIP",
                      calculation: "5 + 5 + 5 + 5 + 5 + 5 + 5 + 5 + 5",
                      answer: 45,
                      multiplication: "9 √ó 5",
                      hint: "Cada mesa VIP precisa de 5 pratos. Calcule o total!",
                      context: "Gest√£o de restaurante ensina planejamento e organiza√ß√£o"
                    },
                    {
                      scenario: "No 'Academia de Super Her√≥is', voc√™ est√° treinando com 6 colegas novatos. O instrutor deu para cada um de voc√™s exatamente 9 exerc√≠cios especiais para praticar esta semana. Quantos exerc√≠cios no total o grupo inteiro precisa completar?",
                      visual: "ü¶∏‚Äç‚ôÇÔ∏è[üìãüìãüìãüìãüìãüìãüìãüìãüìã] √ó 6 novatos",
                      calculation: "9 + 9 + 9 + 9 + 9 + 9",
                      answer: 54,
                      multiplication: "6 √ó 9",
                      hint: "Cada novato recebeu 9 exerc√≠cios. Multiplique!",
                      context: "Temas de super-her√≥is motivam persist√™ncia e esfor√ßo"
                    }
                  ]
                },
                3: { // 10-11 anos - Multiplica√ß√£o com dezenas, produtos at√© 200
                  title: "üëë Mestre do Roblox - Grandes Conquistas",
                  ageRange: "10-11 anos",
                  questions: [
                    {
                      scenario: "Voc√™ criou um 'Imp√©rio Comercial' no Roblox e agora possui 12 lojas diferentes espalhadas pelo mapa. Cada loja gera exatamente 15 Robux de lucro por dia. Se todas as lojas funcionarem perfeitamente por um dia inteiro, quanto Robux voc√™ ganhar√°?",
                      visual: "üè™[üí∞15] √ó 12 lojas = ? Robux por dia",
                      calculation: "15 + 15 + 15... (12 vezes)",
                      answer: 180,
                      multiplication: "12 √ó 15",
                      hint: "Cada loja rende 15 Robux por dia. Multiplique pelo n√∫mero de lojas!",
                      context: "Empreendedorismo digital e gest√£o financeira"
                    },
                    {
                      scenario: "No 'Torneio Mundial de Esportes', voc√™ √© t√©cnico de 14 equipes diferentes. Cada equipe tem exatamente 11 jogadores prontos para competir. Quantos atletas est√£o sob sua responsabilidade no total?",
                      visual: "‚öΩ[üë§üë§üë§üë§üë§üë§üë§üë§üë§üë§üë§] √ó 14 equipes",
                      calculation: "11 + 11 + 11... (14 vezes)",
                      answer: 154,
                      multiplication: "14 √ó 11",
                      hint: "Cada equipe tem 11 jogadores. Multiplique pelo n√∫mero de equipes!",
                      context: "Esportes ensinam lideran√ßa e responsabilidade"
                    },
                    {
                      scenario: "Voc√™ √© arquiteto no 'Cidade dos Sonhos' e recebeu uma encomenda gigante: construir 16 edif√≠cios residenciais id√™nticos. Cada edif√≠cio precisa de exatamente 13 tipos diferentes de materiais de constru√ß√£o. Quantos tipos de materiais voc√™ precisa calcular no total?",
                      visual: "üè¢[üß±üì¶‚öôÔ∏èü™üüö™...13 tipos] √ó 16 edif√≠cios",
                      calculation: "13 + 13 + 13... (16 vezes)",
                      answer: 208,
                      multiplication: "16 √ó 13",
                      hint: "Cada edif√≠cio usa 13 tipos de materiais. Multiplique!",
                      context: "Arquitetura estimula pensamento espacial e planejamento"
                    },
                    {
                      scenario: "No 'Festival de M√∫sica Virtual', voc√™ √© organizador de 13 palcos simult√¢neos. Cada palco ter√° exatamente 12 apresenta√ß√µes musicais durante o evento. Quantas apresenta√ß√µes musicais acontecer√£o no festival inteiro?",
                      visual: "üéµ[üé§üé§üé§üé§üé§üé§üé§üé§üé§üé§üé§üé§] √ó 13 palcos",
                      calculation: "12 + 12 + 12... (13 vezes)",
                      answer: 156,
                      multiplication: "13 √ó 12",
                      hint: "Cada palco ter√° 12 apresenta√ß√µes. Multiplique pelo n√∫mero de palcos!",
                      context: "Organiza√ß√£o de eventos desenvolve habilidades de coordena√ß√£o"
                    },
                    {
                      scenario: "Voc√™ √© l√≠der da alian√ßa mais poderosa no 'Estrat√©gia Gal√°ctica'. Sua alian√ßa controla 15 planetas habitados. Cada planeta contribui com exatamente 14 naves de guerra para a frota unificada. Quantas naves de guerra sua alian√ßa possui no total?",
                      visual: "ü™ê[üöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄüöÄ] √ó 15 planetas",
                      calculation: "14 + 14 + 14... (15 vezes)",
                      answer: 210,
                      multiplication: "15 √ó 14",
                      hint: "Cada planeta contribui com 14 naves. Multiplique pelo n√∫mero de planetas!",
                      context: "Estrat√©gia espacial desenvolve pensamento t√°tico"
                    }
                  ]
                }
              };

            const getFontStyle = () => ({
                fontFamily: selectedFont === 'dyslexic' ? "'OpenDyslexic', sans-serif" : "'Comic Sans MS', cursive"
            });

            const handleStartName = () => {
                if (studentName.trim()) {
                    setCurrentPhase('selecao');
                }
            };

            const selecionarBloco = (bloco) => {
                setCurrentBlock(bloco);
                setCurrentQuestion(0);
                setScore(0);
                setCurrentPhase('jogo');
                setStartTime(Date.now());
            };

            const submitAnswer = () => {
                const questionData = questionsBlocks[currentBlock].questions[currentQuestion];
                const correct = parseInt(userAnswer) === questionData.answer;
                
                if(correct) {
                    setScore(prev => prev + 1);
                }

                setIsCorrect(correct);
                setShowFeedback(true);

                setTimeout(() => {
                    nextQuestion();
                }, 3000);
            };

            const nextQuestion = () => {
                setShowFeedback(false);
                setUserAnswer('');
                if (currentQuestion < questionsBlocks[currentBlock].questions.length - 1) {
                    setCurrentQuestion(prev => prev + 1);
                } else {
                    saveResult();
                    setCurrentPhase('selecao');
                }
            };
            
            const saveResult = () => {
                const timeSpent = Math.round((Date.now() - startTime) / 1000);
                const config = questionsBlocks[currentBlock];
                const result = {
                    Nome: studentName,
                    Materia: 'Matematica',
                    Atividade: 'Fazenda de Mobs',
                    Bloco: config.title,
                    Questao: `Bloco_${currentBlock}`,
                    Tempo_Execucao: `${timeSpent}s`,
                    Acertos: score,
                    Erros: config.questions.length - score,
                    Score: `${Math.round((score / config.questions.length) * 100)}%`
                };
                const updatedResults = [...sessionResults, result];
                setSessionResults(updatedResults);
                localStorage.setItem('fazendaMobsResults', JSON.stringify(updatedResults));
            };

            const downloadCSV = () => {
                const resultsToExport = JSON.parse(localStorage.getItem('fazendaMobsResults') || '[]');
                if (resultsToExport.length === 0) {
                    alert("Nenhum dado para exportar!");
                    return;
                }
                const header = 'Nome,Materia,Atividade,Bloco,Questao,Tempo_Execucao,Acertos,Erros,Score\n';
                const csvContent = resultsToExport.map(r => `${r.Nome},${r.Materia},${r.Atividade},${r.Bloco},${r.Questao},${r.Tempo_Execucao},${r.Acertos},${r.Erros},${r.Score}`).join('\n');
                const fullContent = header + csvContent;
                const blob = new Blob([fullContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `resultados-fazenda_mobs-${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                localStorage.removeItem('fazendaMobsResults');
                setSessionResults([]);
                setCurrentPhase('inicio');
            };

            if (currentPhase === 'inicio') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-green-400 to-blue-500 p-4 flex items-center justify-center" style={getFontStyle()}>
                        <div className="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center">
                            <h1 className="text-4xl font-bold text-gray-800 mb-4">üêÑ Fazenda de Mobs</h1>
                            <p className="text-lg text-gray-600 mb-6">Aprenda multiplica√ß√£o gerenciando sua fazenda de mobs do Roblox!</p>
                            <input type="text" placeholder="Digite seu nome" value={studentName} onChange={(e) => setStudentName(e.target.value)} className="w-full p-4 border-2 border-gray-300 rounded-lg text-xl mb-6" />
                            <button onClick={handleStartName} disabled={!studentName.trim()} className="w-full py-4 bg-green-600 text-white font-bold text-xl rounded-lg hover:bg-green-700 disabled:opacity-50">
                                Come√ßar
                            </button>
                            <a href="../index.html" className="block w-full mt-4 px-6 py-3 text-center bg-gray-500 text-white rounded-lg hover:bg-gray-600">Voltar ao Portal</a>
                        </div>
                    </div>
                );
            }

            if (currentPhase === 'selecao') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-green-400 to-blue-500 p-4" style={getFontStyle()}>
                        <div className="max-w-4xl mx-auto">
                            <h1 className="text-4xl font-bold text-white text-center mb-8">Ol√°, {studentName}! Escolha um bloco de desafios:</h1>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                {Object.entries(questionsBlocks).map(([key, config]) => (
                                    <div key={key} className="bg-white rounded-lg p-6 shadow-lg cursor-pointer" onClick={() => selecionarBloco(parseInt(key))}>
                                        <h3 className="text-xl font-bold mb-2">{config.title}</h3>
                                        <p className="text-gray-600">{config.ageRange}</p>
                                    </div>
                                ))}
                            </div>
                             <button onClick={downloadCSV} className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-bold">
                                Finalizar Sess√£o e Baixar CSV
                            </button>
                        </div>
                    </div>
                );
            }

            if (currentPhase === 'jogo') {
                const questionData = questionsBlocks[currentBlock].questions[currentQuestion];
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-400 via-purple-400 to-pink-400 p-4 flex items-center justify-center" style={getFontStyle()}>
                        <div className="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8">
                            <div className="mb-6">
                                <p className="text-lg text-gray-600 text-center">Quest√£o {currentQuestion + 1} de {questionsBlocks[currentBlock].questions.length}</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-2">
                                    <div className="bg-green-500 h-4 rounded-full" style={{width: `${((currentQuestion + 1) / questionsBlocks[currentBlock].questions.length) * 100}%`}}></div>
                                </div>
                            </div>
                            <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6 rounded-r-lg">
                                <h3 className="text-xl font-semibold text-gray-800">{questionData.scenario}</h3>
                            </div>
                            <div className="text-center my-6 text-3xl font-mono text-gray-700">{questionData.visual}</div>
                            {!showFeedback ? (
                                <div className="space-y-4">
                                    <input
                                        type="number"
                                        value={userAnswer}
                                        onChange={(e) => setUserAnswer(e.target.value)}
                                        className="w-full p-4 border-2 border-gray-300 rounded-lg text-xl text-center"
                                        placeholder="Sua resposta..."
                                    />
                                    <button onClick={submitAnswer} disabled={!userAnswer} className="w-full py-4 bg-blue-600 text-white font-bold text-xl rounded-lg disabled:opacity-50">
                                        Confirmar
                                    </button>
                                </div>
                            ) : (
                                <div className={`text-center p-6 rounded-lg ${isCorrect ? 'bg-green-100' : 'bg-red-100'}`}>
                                    <h4 className={`text-2xl font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>{isCorrect ? 'Correto!' : 'Quase l√°!'}</h4>
                                    <p className="text-lg mt-2">A resposta √© {questionData.answer}. ({questionData.multiplication})</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }
        };

        ReactDOM.render(<FazendaMobs />, document.getElementById('root'));
    </script>
</body>
</html>