<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz de Identifica√ß√£o de Opera√ß√µes Matem√°ticas</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fuzzy+Bubbles:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #667eea;
        --secondary-color: #764ba2;
        --success-color: #10b981;
        --error-color: #ef4444;
        --warning-color: #f59e0b;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --bg-light: #f9fafb;
        --border-color: #e5e7eb;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: "Comic Neue", "Comic Sans MS", cursive, sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        min-height: 100vh;
        line-height: 1.6;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin: 0 0 10px 0;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .progress-bar {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 25px;
        height: 15px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-fill {
        background: linear-gradient(90deg, #10b981, #059669);
        height: 100%;
        border-radius: 25px;
        transition: width 0.3s ease;
        width: 0%;
      }

      .progress-text {
        color: white;
        text-align: center;
        margin-top: 10px;
        font-weight: 600;
      }

      .quiz-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .block-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .block-button {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        padding: 20px;
        border-radius: 15px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .block-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .block-button.completed {
        background: linear-gradient(135deg, var(--success-color), #059669);
      }

      .block-button.current {
        background: linear-gradient(135deg, var(--warning-color), #d97706);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .question-container {
        margin-bottom: 30px;
      }

      .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .question-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
      }

      .audio-button {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .audio-button:hover {
        transform: scale(1.1);
        box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
      }

      .problem-text {
        font-size: 1.2rem;
        color: var(--text-primary);
        background: var(--bg-light);
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--primary-color);
        margin-bottom: 25px;
      }

      .options-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
        margin-bottom: 25px;
      }

      .option-button {
        background: white;
        border: 2px solid var(--border-color);
        padding: 20px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        display: flex;
        align-items: center;
        font-size: 1.1rem;
      }

      .option-button:hover {
        border-color: var(--primary-color);
        background: rgba(102, 126, 234, 0.05);
        transform: translateY(-2px);
      }

      .option-button.selected {
        background: rgba(102, 126, 234, 0.1);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
      }

      .option-emoji {
        font-size: 2rem;
        margin-right: 15px;
      }

      .feedback-container {
        background: var(--bg-light);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 25px;
      }

      .feedback-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .feedback-icon {
        font-size: 2.5rem;
        margin-right: 15px;
      }

      .feedback-title {
        font-size: 1.3rem;
        font-weight: 700;
      }

      .feedback-correct {
        color: var(--success-color);
        border-left: 4px solid var(--success-color);
      }

      .feedback-incorrect {
        color: var(--error-color);
        border-left: 4px solid var(--error-color);
      }

      .explanation {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        border-left: 3px solid var(--primary-color);
      }

      .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: auto;
      }

      .btn {
        padding: 15px 25px;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        text-align: center;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        background: linear-gradient(135deg, var(--error-color), #dc2626);
        color: white;
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success-color), #059669);
        color: white;
      }

      .results-container {
        text-align: center;
      }

      .score-display {
        font-size: 3rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 20px 0;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 25px 0;
      }

      .stat-card {
        background: var(--bg-light);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-top: 5px;
      }

      .celebration {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, var(--success-color), #059669);
        color: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        text-align: center;
        font-size: 1.5rem;
        font-weight: 700;
        animation: celebrationBounce 0.6s ease-out;
      }

      @keyframes celebrationBounce {
        0% {
          transform: translate(-50%, -50%) scale(0.3);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.1);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
        }
      }

      .hidden {
        display: none !important;
      }

      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        min-height: 100vh;
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .quiz-card {
          padding: 20px;
        }

        .block-selector {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .option-button {
          padding: 15px;
          font-size: 1rem;
        }

        .action-buttons {
          flex-direction: column;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .header h1 {
          font-size: 1.5rem;
        }

        .quiz-card {
          padding: 15px;
        }

        .option-emoji {
          font-size: 1.5rem;
          margin-right: 10px;
        }

        .score-display {
          font-size: 2.5rem;
        }
      }

      /* Accessibility */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .option-button:focus,
      .btn:focus,
      .audio-button:focus,
      .block-button:focus {
        outline: 3px solid #fbbf24;
        outline-offset: 2px;
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        :root {
          --primary-color: #000080;
          --secondary-color: #000040;
          --success-color: #006400;
          --error-color: #8b0000;
          --text-primary: #000000;
          --text-secondary: #333333;
        }
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Carregando Quiz...</div>
      </div>

      <div class="container hidden" id="main-container">
        <header class="header">
          <h1>Quiz de Opera√ß√µes Matem√°ticas</h1>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-text" id="progress-text">
            Selecione um bloco para come√ßar
          </div>
        </header>

        <main class="quiz-card">
          <!-- Block Selection Screen -->
          <section id="block-selection" class="block-selector">
            <!-- Blocks will be generated here -->
          </section>

          <!-- Question Screen -->
          <section id="question-screen" class="hidden">
            <div class="question-container">
              <div class="question-header">
                <h2 class="question-title" id="question-title">Quest√£o 1</h2>
                <button
                  class="audio-button"
                  id="audio-btn"
                  aria-label="Ouvir enunciado da quest√£o"
                >
                  üîä
                </button>
              </div>

              <div class="problem-text" id="problem-text">
                <!-- Problem text will be inserted here -->
              </div>

              <div id="options-container" class="options-grid">
                <!-- Options will be generated here -->
              </div>

              <div id="feedback-container" class="feedback-container hidden">
                <!-- Feedback will be shown here -->
              </div>
            </div>

            <div class="action-buttons" id="action-buttons">
              <!-- Action buttons will be generated here -->
            </div>
          </section>

          <!-- Results Screen -->
          <section id="results-screen" class="results-container hidden">
            <h2>Parab√©ns! Voc√™ completou o bloco!</h2>
            <div class="score-display" id="final-score">0%</div>

            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="correct-answers">0</div>
                <div class="stat-label">Acertos</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="wrong-answers">0</div>
                <div class="stat-label">Erros</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="total-time">0s</div>
                <div class="stat-label">Tempo Total</div>
              </div>
            </div>

            <div class="action-buttons">
              <button class="btn btn-primary" id="try-again-btn">
                üîÑ Tentar Novamente
              </button>
              <button class="btn btn-success" id="export-csv-btn">
                üìä Exportar Resultado
              </button>
              <button class="btn btn-secondary" id="back-to-blocks-btn">
                üè† Voltar aos Blocos
              </button>
            </div>
          </section>
        </main>
      </div>

      <!-- Celebration overlay -->
      <div id="celebration" class="celebration hidden">
        <div id="celebration-message">Excelente!</div>
      </div>
    </div>

    <script>
      // Educational content structure with 9 progressive blocks
      const QUIZ_DATA = {
        subject: "matematica",
        activity: "operacoes_basicas",
        blocks: [
          // BLOCO 1 - B√°sico: Soma simples (n√∫meros pequenos)
          {
            id: 1,
            name: "Bloco 1: Soma B√°sica",
            level: "b√°sico",
            questions: [
              {
                text: "Jo√£o tem 2 ma√ß√£s e ganhou mais 3 ma√ß√£s. Quantas ma√ß√£s ele tem agora?",
                operation: "soma",
                calculation: "2 + 3 = 5",
                explanation:
                  "Quando ganhamos mais algo, usamos a soma para juntar as quantidades.",
              },
              {
                text: "Maria comprou 4 balas e depois comprou mais 2 balas. Quantas balas ela tem?",
                operation: "soma",
                calculation: "4 + 2 = 6",
                explanation:
                  "Quando compramos mais de algo, somamos as quantidades.",
              },
              {
                text: "No parque h√° 3 p√°ssaros. Chegaram mais 2 p√°ssaros. Quantos p√°ssaros h√° agora?",
                operation: "soma",
                calculation: "3 + 2 = 5",
                explanation: "Quando chegam mais, usamos a soma.",
              },
              {
                text: "Ana desenhou 1 estrela e depois desenhou mais 4 estrelas. Quantas estrelas ela desenhou?",
                operation: "soma",
                calculation: "1 + 4 = 5",
                explanation: "Quando desenhamos mais, somamos tudo.",
              },
            ],
          },
          // BLOCO 2 - B√°sico: Subtra√ß√£o simples
          {
            id: 2,
            name: "Bloco 2: Subtra√ß√£o B√°sica",
            level: "b√°sico",
            questions: [
              {
                text: "Pedro tinha 5 carrinhos e perdeu 2 carrinhos. Com quantos carrinhos ele ficou?",
                operation: "subtracao",
                calculation: "5 - 2 = 3",
                explanation:
                  "Quando perdemos algo, usamos a subtra√ß√£o para tirar a quantidade.",
              },
              {
                text: "Havia 6 flores no jardim. 3 flores murcharam. Quantas flores restaram?",
                operation: "subtracao",
                calculation: "6 - 3 = 3",
                explanation: "Quando algo some ou murcha, subtra√≠mos.",
              },
              {
                text: "Laura comeu 2 dos seus 7 doces. Quantos doces sobraram?",
                operation: "subtracao",
                calculation: "7 - 2 = 5",
                explanation:
                  "Quando comemos algo, subtra√≠mos o que foi consumido.",
              },
              {
                text: "Havia 8 bal√µes. 3 bal√µes voaram. Quantos bal√µes restaram?",
                operation: "subtracao",
                calculation: "8 - 3 = 5",
                explanation: "Quando algo vai embora, usamos subtra√ß√£o.",
              },
            ],
          },
          // BLOCO 3 - B√°sico: Multiplica√ß√£o simples (tabuada b√°sica)
          {
            id: 3,
            name: "Bloco 3: Multiplica√ß√£o B√°sica",
            level: "b√°sico",
            questions: [
              {
                text: "Cada caixa tem 3 l√°pis. Se temos 2 caixas, quantos l√°pis temos ao todo?",
                operation: "multiplicacao",
                calculation: "3 √ó 2 = 6",
                explanation:
                  "Quando temos grupos iguais, multiplicamos para saber o total.",
              },
              {
                text: "Um prato tem 4 cookies. Quantos cookies h√° em 3 pratos iguais?",
                operation: "multiplicacao",
                calculation: "4 √ó 3 = 12",
                explanation:
                  "Quando repetimos uma quantidade v√°rias vezes, usamos multiplica√ß√£o.",
              },
              {
                text: "Cada crian√ßa tem 2 m√£os. Quantas m√£os t√™m 5 crian√ßas juntas?",
                operation: "multiplicacao",
                calculation: "2 √ó 5 = 10",
                explanation:
                  "Para contar grupos iguais rapidamente, multiplicamos.",
              },
              {
                text: "Cada casa tem 3 janelas. Em uma rua com 4 casas iguais, quantas janelas h√°?",
                operation: "multiplicacao",
                calculation: "3 √ó 4 = 12",
                explanation:
                  "Quando todas as partes s√£o iguais, multiplicamos.",
              },
            ],
          },
          // BLOCO 4 - Intermedi√°rio: Opera√ß√µes combinadas simples
          {
            id: 4,
            name: "Bloco 4: Opera√ß√µes Combinadas",
            level: "intermedi√°rio",
            questions: [
              {
                text: "Carlos tinha 10 figurinhas, ganhou 5 novas figurinhas de um amigo e depois deu 3 figurinhas para sua irm√£. Quantas figurinhas ele tem agora?",
                operation: "soma",
                calculation: "10 + 5 - 3 = 12",
                explanation:
                  "Primeiro somamos o que ganhou, depois subtra√≠mos o que deu. O resultado final √© soma porque ganhou mais do que deu.",
              },
              {
                text: "Em uma festa havia 20 bal√µes decorativos. Durante a festa, 8 bal√µes estouraram e depois foram colocados mais 6 bal√µes novos. Quantos bal√µes h√° agora?",
                operation: "subtracao",
                calculation: "20 - 8 + 6 = 18",
                explanation:
                  "Primeiro subtra√≠mos os que estouraram, depois somamos os novos. Como perdemos mais do que ganhamos, √© subtra√ß√£o.",
              },
              {
                text: "Marina organizou seus livros em 4 pilhas, cada uma com 6 livros. Depois emprestou 8 livros para amigos. Quantos livros ela ainda tem?",
                operation: "subtracao",
                calculation: "4 √ó 6 - 8 = 24 - 8 = 16",
                explanation:
                  "Primeiro multiplicamos para saber o total, depois subtra√≠mos os emprestados.",
              },
              {
                text: "Um padeiro fez 15 p√£es pela manh√£ e mais 12 p√£es √† tarde. Se ele vendeu 20 p√£es durante o dia, quantos p√£es sobraram?",
                operation: "subtracao",
                calculation: "15 + 12 - 20 = 27 - 20 = 7",
                explanation:
                  "Primeiro somamos todos os p√£es feitos, depois subtra√≠mos os vendidos.",
              },
            ],
          },
          // BLOCO 5 - Intermedi√°rio: Divis√£o simples
          {
            id: 5,
            name: "Bloco 5: Divis√£o B√°sica",
            level: "intermedi√°rio",
            questions: [
              {
                text: "A professora tem 12 l√°pis para distribuir igualmente entre 4 alunos. Quantos l√°pis cada aluno receber√°?",
                operation: "divisao",
                calculation: "12 √∑ 4 = 3",
                explanation:
                  "Quando dividimos algo igualmente entre pessoas, usamos divis√£o.",
              },
              {
                text: "Um jardineiro plantou 18 mudas em fileiras, colocando 6 mudas em cada fileira. Quantas fileiras ele fez?",
                operation: "divisao",
                calculation: "18 √∑ 6 = 3",
                explanation:
                  "Para descobrir quantos grupos podemos formar, dividimos o total pelo tamanho de cada grupo.",
              },
              {
                text: "Uma pizza foi cortada em 8 peda√ßos iguais. Se 4 crian√ßas v√£o dividir a pizza igualmente, quantos peda√ßos cada uma comer√°?",
                operation: "divisao",
                calculation: "8 √∑ 4 = 2",
                explanation:
                  "Quando repartimos algo em partes iguais, usamos divis√£o.",
              },
              {
                text: "Em uma caixa h√° 20 chocolates. Se queremos fazer pacotes com 5 chocolates cada, quantos pacotes conseguiremos fazer?",
                operation: "divisao",
                calculation: "20 √∑ 5 = 4",
                explanation:
                  "Para saber quantos grupos de tamanho fixo podemos fazer, dividimos.",
              },
            ],
          },
          // BLOCO 6 - Intermedi√°rio: Problemas de compara√ß√£o
          {
            id: 6,
            name: "Bloco 6: Compara√ß√µes",
            level: "intermedi√°rio",
            questions: [
              {
                text: "Joana tem 15 adesivos e sua amiga Carla tem 9 adesivos. Quantos adesivos Joana tem a mais que Carla?",
                operation: "subtracao",
                calculation: "15 - 9 = 6",
                explanation:
                  "Para descobrir a diferen√ßa entre duas quantidades, subtra√≠mos a menor da maior.",
              },
              {
                text: "Roberto fez 25 pontos no jogo e Pedro fez 18 pontos. Quantos pontos Roberto precisa perder para ficar com a mesma pontua√ß√£o que Pedro?",
                operation: "subtracao",
                calculation: "25 - 18 = 7",
                explanation:
                  "Para igualar quantidades diferentes, calculamos a diferen√ßa usando subtra√ß√£o.",
              },
              {
                text: "Uma escola tem 3 vezes mais alunos que outra escola. Se a escola menor tem 45 alunos, quantos alunos tem a escola maior?",
                operation: "multiplicacao",
                calculation: "45 √ó 3 = 135",
                explanation:
                  'Quando uma quantidade √© "vezes maior", multiplicamos.',
              },
              {
                text: "Em um concurso, Ana acertou o dobro de quest√µes que Bruno. Se Bruno acertou 12 quest√µes, quantas quest√µes Ana acertou?",
                operation: "multiplicacao",
                calculation: "12 √ó 2 = 24",
                explanation: "O dobro significa multiplicar por 2.",
              },
            ],
          },
          // BLOCO 7 - Avan√ßado: Problemas com fra√ß√µes simples
          {
            id: 7,
            name: "Bloco 7: Problemas Avan√ßados",
            level: "avan√ßado",
            questions: [
              {
                text: "Uma f√°brica de brinquedos produz 240 carrinhos por dia. Se ela funciona 6 dias por semana, quantos carrinhos produz por semana? E se metade da produ√ß√£o semanal for exportada, quantos carrinhos ficam no pa√≠s?",
                operation: "multiplicacao",
                calculation: "240 √ó 6 = 1440, depois 1440 √∑ 2 = 720",
                explanation:
                  "Primeiro multiplicamos para a produ√ß√£o semanal, depois dividimos por 2 para encontrar a metade.",
              },
              {
                text: "Um agricultor plantou 180 p√©s de tomate em fileiras iguais. Se cada fileira tem 15 p√©s de tomate, quantas fileiras ele fez? Se cada p√© produzir 8 tomates, quantos tomates ele colher√° ao todo?",
                operation: "divisao",
                calculation:
                  "180 √∑ 15 = 12 fileiras, depois 180 √ó 8 = 1440 tomates",
                explanation:
                  "Primeiro dividimos para encontrar as fileiras, depois multiplicamos para a produ√ß√£o total.",
              },
              {
                text: "Em uma biblioteca h√° 450 livros organizados em 15 estantes iguais. Se cada estante tem 5 prateleiras iguais, quantos livros h√° em cada prateleira?",
                operation: "divisao",
                calculation:
                  "450 √∑ 15 = 30 livros por estante, depois 30 √∑ 5 = 6 livros por prateleira",
                explanation:
                  "Primeiro dividimos pelos grupos maiores, depois pelos grupos menores dentro deles.",
              },
              {
                text: "Carlos economiza R$ 15 por semana. Depois de 8 semanas, ele gastou R$ 75 em um presente e depois economizou mais R$ 25. Quanto dinheiro ele tem agora?",
                operation: "soma",
                calculation: "15 √ó 8 - 75 + 25 = 120 - 75 + 25 = 70",
                explanation:
                  "Calculamos total economizado, subtra√≠mos o gasto e somamos a economia adicional.",
              },
            ],
          },
          // BLOCO 8 - Avan√ßado: Problemas de propor√ß√£o
          {
            id: 8,
            name: "Bloco 8: Propor√ß√µes",
            level: "avan√ßado",
            questions: [
              {
                text: "Uma receita de bolo usa 3 ovos para fazer 1 bolo que serve 8 pessoas. Se queremos fazer bolos para uma festa de 24 pessoas, mantendo a mesma propor√ß√£o, quantos ovos precisaremos?",
                operation: "multiplicacao",
                calculation: "24 √∑ 8 = 3 bolos, ent√£o 3 √ó 3 = 9 ovos",
                explanation:
                  "Primeiro descobrimos quantos bolos precisamos, depois multiplicamos pelos ovos de cada bolo.",
              },
              {
                text: "Em uma escola, a raz√£o entre meninos e meninas √© de 3 para 2. Se h√° 15 meninos na classe, quantas meninas h√°? Qual √© o total de alunos na classe?",
                operation: "divisao",
                calculation:
                  "15 √∑ 3 = 5 grupos, ent√£o 5 √ó 2 = 10 meninas, total = 15 + 10 = 25",
                explanation:
                  "Usamos a propor√ß√£o para encontrar o n√∫mero de grupos e depois calculamos as meninas.",
              },
              {
                text: "Um mapa tem escala 1:50, ou seja, cada cent√≠metro no mapa representa 50 cent√≠metros na realidade. Se a dist√¢ncia entre duas cidades no mapa √© 12 cm, qual √© a dist√¢ncia real entre elas em metros?",
                operation: "multiplicacao",
                calculation: "12 √ó 50 = 600 cm = 6 metros",
                explanation:
                  "Multiplicamos pela escala e convertemos cent√≠metros para metros.",
              },
              {
                text: "Uma m√°quina produz 120 pe√ßas em 4 horas trabalhando na mesma velocidade constante. Quantas pe√ßas ela produzir√° em 7 horas? E em quantas horas ela produzir√° 180 pe√ßas?",
                operation: "divisao",
                calculation:
                  "120 √∑ 4 = 30 pe√ßas/hora, ent√£o 30 √ó 7 = 210 pe√ßas em 7h, e 180 √∑ 30 = 6 horas",
                explanation:
                  "Primeiro encontramos a velocidade de produ√ß√£o, depois usamos para os outros c√°lculos.",
              },
            ],
          },
          // BLOCO 9 - Avan√ßado: Problemas complexos com m√∫ltiplas opera√ß√µes
          {
            id: 9,
            name: "Bloco 9: Desafios Complexos",
            level: "avan√ßado",
            questions: [
              {
                text: "Uma loja vende camisetas por R$ 25 cada uma. Durante uma promo√ß√£o, quem comprar 3 camisetas ganha uma quarta gr√°tis. Se um cliente quer levar 12 camisetas, quanto ele pagar√° aproveitando a promo√ß√£o ao m√°ximo?",
                operation: "multiplicacao",
                calculation:
                  "12 √∑ 4 = 3 promo√ß√µes (9 pagas + 3 gr√°tis), ent√£o 9 √ó 25 = 225",
                explanation:
                  "Calculamos quantas promo√ß√µes cabem e quantas camisetas realmente precisa pagar.",
              },
              {
                text: "Um √¥nibus escolar faz 4 viagens por dia, transportando 32 alunos por viagem. Se o √¥nibus funciona 5 dias por semana durante 36 semanas no ano, quantos alunos-viagem ele transporta no ano todo?",
                operation: "multiplicacao",
                calculation: "4 √ó 32 √ó 5 √ó 36 = 128 √ó 180 = 23.040",
                explanation:
                  "Multiplicamos viagens por dia √ó alunos por viagem √ó dias por semana √ó semanas por ano.",
              },
              {
                text: "Uma pizzaria oferece pizza individual por R$ 18 ou pizza fam√≠lia (que serve 4 pessoas) por R$ 65. Uma fam√≠lia de 6 pessoas quer economizar o m√°ximo poss√≠vel. Qual combina√ß√£o de pizzas deve escolher e quanto gastar√°?",
                operation: "subtracao",
                calculation:
                  "1 fam√≠lia + 2 individuais = 65 + 36 = 101, vs 6 individuais = 108, economia de 7",
                explanation:
                  "Comparamos diferentes combina√ß√µes para encontrar a mais econ√¥mica: uma pizza fam√≠lia mais duas individuais.",
              },
              {
                text: "Um jardineiro planta flores em canteiros retangulares. Cada canteiro tem 8 fileiras com 12 flores cada uma. Se ele tem 15 canteiros iguais e cada muda de flor custa R$ 3, quanto ele gastou em flores? Se 5% das flores n√£o vingaram e precisaram ser replantadas, qual foi o gasto total?",
                operation: "multiplicacao",
                calculation:
                  "8 √ó 12 √ó 15 = 1440 flores, √ó 3 = 4320. 5% = 72 flores extras √ó 3 = 216. Total = 4536",
                explanation:
                  "Calculamos total de flores, custo inicial, flores que n√£o vingaram e custo adicional.",
              },
            ],
          },
        ],
      };

      // Operations available for selection
      const OPERATIONS = [
        { value: "soma", label: "Adi√ß√£o (+)", emoji: "‚ûï" },
        { value: "subtracao", label: "Subtra√ß√£o (-)", emoji: "‚ûñ" },
        { value: "multiplicacao", label: "Multiplica√ß√£o (√ó)", emoji: "‚úñÔ∏è" },
        { value: "divisao", label: "Divis√£o (√∑)", emoji: "‚ûó" },
      ];

      // Game state
      let currentState = {
        selectedBlock: null,
        currentQuestion: 0,
        selectedAnswer: null,
        showFeedback: false,
        correctAnswers: 0,
        wrongAnswers: 0,
        startTime: null,
        questionStartTime: null,
        responses: [],
        blockStartTime: null,
      };

      // Initialize the application
      function initApp() {
        setTimeout(() => {
          document.getElementById("loading").classList.add("hidden");
          document.getElementById("main-container").classList.remove("hidden");
          generateBlockButtons();
          setupEventListeners();
        }, 1000);
      }

      // Generate block selection buttons
      function generateBlockButtons() {
        const container = document.getElementById("block-selection");
        container.innerHTML = "";

        QUIZ_DATA.blocks.forEach((block) => {
          const button = document.createElement("button");
          button.className = "block-button";
          button.innerHTML = `
                    <div>${block.name}</div>
                    <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">
                        N√≠vel: ${block.level}
                    </div>
                `;
          button.onclick = () => startBlock(block.id);
          container.appendChild(button);
        });
      }

      // Start a specific block
      function startBlock(blockId) {
        currentState.selectedBlock = blockId;
        currentState.currentQuestion = 0;
        currentState.correctAnswers = 0;
        currentState.wrongAnswers = 0;
        currentState.responses = [];
        currentState.blockStartTime = new Date();

        document.getElementById("block-selection").classList.add("hidden");
        document.getElementById("question-screen").classList.remove("hidden");

        showQuestion();
        updateProgress();
      }

      // Show current question
      function showQuestion() {
        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const question = block.questions[currentState.currentQuestion];

        currentState.selectedAnswer = null;
        currentState.showFeedback = false;
        currentState.questionStartTime = new Date();

        // Update question title
        document.getElementById("question-title").textContent =
          `Quest√£o ${currentState.currentQuestion + 1} de ${block.questions.length}`;

        // Update problem text
        document.getElementById("problem-text").textContent = question.text;

        // Generate options
        generateOptions();

        // Hide feedback and show options
        document.getElementById("feedback-container").classList.add("hidden");
        document.getElementById("options-container").classList.remove("hidden");

        // Update action buttons
        updateActionButtons();

        // Setup audio button
        setupAudioButton();
      }

      // Generate answer options
      function generateOptions() {
        const container = document.getElementById("options-container");
        container.innerHTML = "";

        OPERATIONS.forEach((operation, index) => {
          const button = document.createElement("button");
          button.className = "option-button";
          button.innerHTML = `
                    <span class="option-emoji">${operation.emoji}</span>
                    <span>${index + 1}. ${operation.label}</span>
                `;
          button.onclick = () => selectAnswer(operation.value, button);
          container.appendChild(button);
        });
      }

      // Select an answer
      function selectAnswer(value, buttonElement) {
        // Remove previous selection
        document.querySelectorAll(".option-button").forEach((btn) => {
          btn.classList.remove("selected");
        });

        // Add selection to clicked button
        buttonElement.classList.add("selected");
        currentState.selectedAnswer = value;

        // Show feedback after a short delay
        setTimeout(() => {
          showFeedback();
        }, 500);
      }

      // Show feedback for the answer
      function showFeedback() {
        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const question = block.questions[currentState.currentQuestion];
        const isCorrect = currentState.selectedAnswer === question.operation;
        const questionTime = new Date() - currentState.questionStartTime;

        // Update statistics
        if (isCorrect) {
          currentState.correctAnswers++;
          showCelebration("Excelente! üéâ");
        } else {
          currentState.wrongAnswers++;
        }

        // Record response
        currentState.responses.push({
          question: currentState.currentQuestion + 1,
          correct: isCorrect,
          timeSpent: questionTime,
          selectedAnswer: currentState.selectedAnswer,
          correctAnswer: question.operation,
        });

        // Hide options and show feedback
        document.getElementById("options-container").classList.add("hidden");
        const feedbackContainer = document.getElementById("feedback-container");
        feedbackContainer.classList.remove("hidden");

        // Generate feedback content
        const correctOperation = OPERATIONS.find(
          (op) => op.value === question.operation,
        );
        feedbackContainer.className = `feedback-container ${isCorrect ? "feedback-correct" : "feedback-incorrect"}`;
        feedbackContainer.innerHTML = `
                <div class="feedback-header">
                    <span class="feedback-icon">${isCorrect ? "‚úÖ" : "‚ùå"}</span>
                    <span class="feedback-title">${isCorrect ? "Correto!" : "N√£o √© essa opera√ß√£o..."}</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Resposta correta:</strong> ${correctOperation.label}
                </div>
                <div class="explanation">
                    <strong>Explica√ß√£o:</strong> ${question.explanation}
                </div>
                <div class="explanation" style="margin-top: 10px;">
                    <strong>C√°lculo:</strong> ${question.calculation}
                </div>
            `;

        currentState.showFeedback = true;
        updateActionButtons();
      }

      // Show celebration message
      function showCelebration(message) {
        const celebration = document.getElementById("celebration");
        document.getElementById("celebration-message").textContent = message;
        celebration.classList.remove("hidden");

        setTimeout(() => {
          celebration.classList.add("hidden");
        }, 2000);
      }

      // Update action buttons based on current state
      function updateActionButtons() {
        const container = document.getElementById("action-buttons");
        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const isLastQuestion =
          currentState.currentQuestion >= block.questions.length - 1;

        if (currentState.showFeedback) {
          container.innerHTML = `
                    <button class="btn btn-primary" onclick="handleNext()">
                        ${isLastQuestion ? "üèÅ Ver Resultado" : "‚û°Ô∏è Pr√≥xima Quest√£o"}
                    </button>
                    <button class="btn btn-secondary" onclick="backToBlocks()">
                        üè† Voltar aos Blocos
                    </button>
                `;
        } else {
          container.innerHTML = `
                    <button class="btn btn-secondary" onclick="backToBlocks()">
                        ‚Üê Voltar
                    </button>
                `;
        }
      }

      // Handle next question or show results
      function handleNext() {
        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );

        if (currentState.currentQuestion < block.questions.length - 1) {
          currentState.currentQuestion++;
          showQuestion();
          updateProgress();
        } else {
          showResults();
        }
      }

      // Show results screen
      function showResults() {
        document.getElementById("question-screen").classList.add("hidden");
        document.getElementById("results-screen").classList.remove("hidden");

        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const totalQuestions = block.questions.length;
        const score = Math.round(
          (currentState.correctAnswers / totalQuestions) * 100,
        );
        const totalTime = Math.round(
          (new Date() - currentState.blockStartTime) / 1000,
        );

        document.getElementById("final-score").textContent = `${score}%`;
        document.getElementById("correct-answers").textContent =
          currentState.correctAnswers;
        document.getElementById("wrong-answers").textContent =
          currentState.wrongAnswers;
        document.getElementById("total-time").textContent = `${totalTime}s`;

        setupResultButtons();
      }

      // Setup result screen buttons
      function setupResultButtons() {
        document.getElementById("try-again-btn").onclick = () => {
          startBlock(currentState.selectedBlock);
        };

        document.getElementById("export-csv-btn").onclick = exportCSV;
        document.getElementById("back-to-blocks-btn").onclick = backToBlocks;
      }

      // Export results to CSV
      function exportCSV() {
        const studentName =
          prompt("Digite seu nome para o relat√≥rio:") || "Aluno";
        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const totalTime = Math.round(
          (new Date() - currentState.blockStartTime) / 1000,
        );
        const score = Math.round(
          (currentState.correctAnswers / block.questions.length) * 100,
        );

        let csvContent =
          "Nome,Materia,Atividade,Bloco,Questao,Tempo_Execucao,Acertos,Erros,Score\n";

        currentState.responses.forEach((response) => {
          csvContent +=
            [
              studentName,
              QUIZ_DATA.subject,
              QUIZ_DATA.activity,
              currentState.selectedBlock,
              response.question,
              Math.round(response.timeSpent / 1000),
              response.correct ? 1 : 0,
              response.correct ? 0 : 1,
              response.correct ? 100 : 0,
            ].join(",") + "\n";
        });

        // Add summary row
        csvContent +=
          [
            studentName,
            QUIZ_DATA.subject,
            QUIZ_DATA.activity,
            currentState.selectedBlock,
            "TOTAL",
            totalTime,
            currentState.correctAnswers,
            currentState.wrongAnswers,
            score,
          ].join(",") + "\n";

        const blob = new Blob([csvContent], { type: "text/csv" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `operacoes_matematicas_bloco_${currentState.selectedBlock}_${new Date().toISOString().split("T")[0]}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
      }

      // Go back to block selection
      function backToBlocks() {
        currentState.selectedBlock = null;
        currentState.currentQuestion = 0;

        document.getElementById("question-screen").classList.add("hidden");
        document.getElementById("results-screen").classList.add("hidden");
        document.getElementById("block-selection").classList.remove("hidden");

        updateProgress();
      }

      // Update progress bar
      function updateProgress() {
        const progressFill = document.getElementById("progress-fill");
        const progressText = document.getElementById("progress-text");

        if (!currentState.selectedBlock) {
          progressFill.style.width = "0%";
          progressText.textContent = "Selecione um bloco para come√ßar";
          return;
        }

        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const progress =
          ((currentState.currentQuestion + 1) / block.questions.length) * 100;

        progressFill.style.width = `${progress}%`;
        progressText.textContent = `${block.name} - Quest√£o ${currentState.currentQuestion + 1} de ${block.questions.length}`;
      }

      // Setup audio button functionality
      function setupAudioButton() {
        const audioButton = document.getElementById("audio-btn");
        audioButton.onclick = () => playAudio();
      }

      // Play audio for current question
      function playAudio() {
        const block = QUIZ_DATA.blocks.find(
          (b) => b.id === currentState.selectedBlock,
        );
        const audioPath = `../media/${QUIZ_DATA.subject}/${QUIZ_DATA.activity}/bloco_${currentState.selectedBlock}/questao_${currentState.currentQuestion + 1}_enunciado.mp3`;

        // Try to play audio, fallback to text-to-speech if available
        const audio = new Audio(audioPath);
        audio.onerror = () => {
          // Fallback: try text-to-speech if supported
          if ("speechSynthesis" in window) {
            const utterance = new SpeechSynthesisUtterance(
              block.questions[currentState.currentQuestion].text,
            );
            utterance.lang = "pt-BR";
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
          } else {
            console.log(
              "Audio file not found and text-to-speech not supported",
            );
          }
        };
        audio.play().catch(() => {
          // Fallback to text-to-speech
          if ("speechSynthesis" in window) {
            const utterance = new SpeechSynthesisUtterance(
              block.questions[currentState.currentQuestion].text,
            );
            utterance.lang = "pt-BR";
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
          }
        });
      }

      // Setup global event listeners
      function setupEventListeners() {
        // Keyboard navigation
        document.addEventListener("keydown", (e) => {
          if (currentState.selectedBlock && !currentState.showFeedback) {
            const key = e.key;
            if (["1", "2", "3", "4"].includes(key)) {
              const index = parseInt(key) - 1;
              const buttons = document.querySelectorAll(".option-button");
              if (buttons[index]) {
                buttons[index].click();
              }
            }
          }

          // Space bar for audio
          if (e.code === "Space" && currentState.selectedBlock) {
            e.preventDefault();
            playAudio();
          }

          // Enter for next question (when feedback is shown)
          if (e.code === "Enter" && currentState.showFeedback) {
            handleNext();
          }

          // Escape to go back
          if (e.code === "Escape") {
            backToBlocks();
          }
        });

        // Prevent context menu on right click for better mobile experience
        document.addEventListener("contextmenu", (e) => {
          e.preventDefault();
        });
      }

      // Initialize the app when DOM is loaded
      document.addEventListener("DOMContentLoaded", initApp);
    </script>
  </body>
</html>
