<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßÆ Calculadora Digital Expert</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .level-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 20px 30px;
            border: none;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .level-btn.avancado {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
        }

        .level-btn.mestre {
            background: linear-gradient(45deg, #fd79a8, #e84393);
            color: white;
        }

        .level-btn.expert {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            color: white;
        }

        .level-btn.active {
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .level-btn:not(.active) {
            opacity: 0.7;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-btn {
            padding: 15px 30px;
            border: 3px solid #FF6B6B;
            border-radius: 15px;
            background: white;
            color: #FF6B6B;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #FF6B6B;
            color: white;
            transform: scale(1.05);
        }

        .progress-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .block-progress {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .question-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
        }

        .question-indicator.current {
            background: #74b9ff;
            color: white;
            transform: scale(1.2);
        }

        .question-indicator.completed {
            background: #00b894;
            color: white;
        }

        .question-indicator.pending {
            background: #ddd;
            color: #666;
        }

        .game-area {
            min-height: 500px;
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .context-box {
            background: linear-gradient(135deg, #FFF3CD, #FFEAA7);
            border: 3px solid #FFEAA7;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Layout Principal */
        .calculator-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        /* Calculadora Real */
        .calculator-container {
            background: #2d3436;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .calculator-title {
            text-align: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .calculator-display {
            background: #74b9ff;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: right;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            font-family: 'Courier New', monospace;
            border: 3px solid #0984e3;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .calc-btn {
            width: 70px;
            height: 70px;
            border: none;
            border-radius: 12px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .calc-btn.number {
            background: #636e72;
            color: white;
        }

        .calc-btn.number:hover {
            background: #74b9ff;
            transform: scale(1.05);
        }

        .calc-btn.operator {
            background: #e17055;
            color: white;
        }

        .calc-btn.operator:hover {
            background: #d63031;
            transform: scale(1.05);
        }

        .calc-btn.equals {
            background: #00b894;
            color: white;
            grid-column: span 2;
        }

        .calc-btn.equals:hover {
            background: #00a085;
            transform: scale(1.02);
        }

        .calc-btn.clear {
            background: #fd79a8;
            color: white;
        }

        .calc-btn.clear:hover {
            background: #e84393;
            transform: scale(1.05);
        }

        .calc-btn:active {
            transform: scale(0.95);
        }

        /* √Årea de Resposta */
        .answer-container {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }

        .answer-title {
            font-size: 24px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 20px;
        }

        .expected-result {
            background: white;
            border: 4px solid #74b9ff;
            border-radius: 15px;
            padding: 30px;
            font-size: 48px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .your-answer {
            background: white;
            border: 4px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            font-size: 36px;
            font-weight: bold;
            color: #636e72;
            margin-bottom: 20px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .your-answer.correct {
            border-color: #00b894;
            background: #d1f2eb;
            color: #00b894;
        }

        .your-answer.incorrect {
            border-color: #e17055;
            background: #fab1a0;
            color: #d63031;
        }

        .status-message {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
        }

        .status-message.waiting {
            background: #e8f4fd;
            color: #74b9ff;
        }

        .status-message.correct {
            background: #d1f2eb;
            color: #00b894;
        }

        .status-message.incorrect {
            background: #fab1a0;
            color: #d63031;
        }

        .attempts-info {
            font-size: 16px;
            color: #636e72;
            margin: 10px 0;
        }

        /* Layout do Detector */
        .detector-layout {
            text-align: center;
        }

        .broken-calculator {
            background: #2d3436;
            border-radius: 15px;
            padding: 30px;
            margin: 30px auto;
            max-width: 500px;
            position: relative;
        }

        .broken-calculator::before {
            content: "‚ö†Ô∏è CALCULADORA COM DEFEITO! ‚ö†Ô∏è";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #e17055;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
        }

        .calculation-display {
            background: #74b9ff;
            color: white;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 32px;
            margin: 20px 0;
            text-align: right;
            line-height: 1.4;
        }

        .manual-input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .manual-input {
            width: 120px;
            height: 70px;
            font-size: 28px;
            text-align: center;
            border: 4px solid #74b9ff;
            border-radius: 15px;
            font-weight: bold;
            background: white;
        }

        .check-btn {
            padding: 20px 40px;
            background: #00b894;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .check-btn:hover {
            background: #00a085;
            transform: scale(1.05);
        }

        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 20px;
            font-weight: bold;
        }

        .feedback.success {
            background: linear-gradient(135deg, #d1f2eb, #a8e6cf);
            color: #00b894;
            border: 3px solid #00b894;
        }

        .feedback.error {
            background: linear-gradient(135deg, #fab1a0, #e17055);
            color: white;
            border: 3px solid #d63031;
        }

        .explanation {
            background: #e8f4fd;
            border: 3px solid #74b9ff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 18px;
            text-align: left;
        }

        .explanation h4 {
            color: #2d3436;
            margin-bottom: 10px;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #2d3436;
        }

        .stat-label {
            font-size: 14px;
            color: #636e72;
            margin-top: 5px;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @media (max-width: 1200px) {
            .calculator-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        @media (max-width: 768px) {
            .level-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .level-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .calculator-buttons {
                gap: 8px;
            }
            
            .calc-btn {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ Calculadora Digital Expert</h1>
            <p>üöÄ Domine a matem√°tica com desafios √©picos! üéØ</p>
        </div>

        <div class="level-selector">
            <button class="level-btn avancado active" data-level="avancado">
                üéØ AVAN√áADO<br>
                <small>Miss√µes b√°sicas</small>
            </button>
            <button class="level-btn mestre" data-level="mestre">
                ‚ö° MESTRE<br>
                <small>Desafios intensos</small>
            </button>
            <button class="level-btn expert" data-level="expert">
                üëë EXPERT<br>
                <small>N√≠vel ninja</small>
            </button>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="montador">üßÆ Calculadora Real</button>
            <button class="mode-btn" data-mode="detector">üîç Calculadora Detectora</button>
        </div>

        <div class="progress-container">
            <div class="block-progress" id="blockProgress">
                <!-- Indicadores de progresso ser√£o inseridos aqui -->
            </div>
            <div style="text-align: center; font-weight: bold; color: #2d3436;">
                <span id="currentQuestionText">Quest√£o 1 de 5</span>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stat-item">
                <div class="stat-number" id="totalScore">0</div>
                <div class="stat-label">üèÜ Pontos Totais</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="currentStreak">0</div>
                <div class="stat-label">üî• Sequ√™ncia</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="levelProgress">0/5</div>
                <div class="stat-label">üìä Progresso do N√≠vel</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="accuracy">100%</div>
                <div class="stat-label">üéØ Precis√£o</div>
            </div>
        </div>

        <div class="game-area" id="gameArea">
            <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
        </div>

        <div class="feedback" id="feedback" style="display: none;"></div>
    </div>

    <script>
        class CalculadoraExpert {
            constructor() {
                this.currentLevel = 'avancado';
                this.currentMode = 'montador';
                this.currentQuestion = 0;
                this.totalScore = 0;
                this.currentStreak = 0;
                this.questionsAnswered = 0;
                this.correctAnswers = 0;
                this.currentQuestionData = null;
                this.calculatorDisplay = '0';
                this.currentExpression = '';
                this.userAnswer = null;
                this.attempts = 0;

                this.levels = {
                    avancado: {
                        name: "üéØ AVAN√áADO",
                        emoji: "üéØ",
                        questions: [
                            {
                                context: "üéÆ Jo√£o est√° vendendo skins raras no Roblox! Ele ganhou {a} Robux na segunda-feira e {b} Robux na ter√ßa-feira. Quantos Robux ele faturou ao todo? üí∞",
                                range: [50, 300]
                            },
                            {
                                context: "üèóÔ∏è Maria est√° construindo uma mega base no Minecraft! Ela precisa de {a} blocos de pedra e {b} blocos de madeira. Quantos blocos ela vai usar no total? ‚õèÔ∏è",
                                range: [100, 500]
                            },
                            {
                                context: "üì± A loja de apps teve {a} downloads na primeira semana e {b} downloads na segunda semana. Qual foi o total de downloads? üìà",
                                range: [200, 800]
                            },
                            {
                                context: "üéØ O streamer ganhou {a} seguidores no YouTube e {b} seguidores no Twitch. Quantos seguidores ele tem no total? üåü",
                                range: [300, 900]
                            },
                            {
                                context: "üèÜ Na competi√ß√£o de e-sports, o time A fez {a} pontos e o time B fez {b} pontos. Quantos pontos foram marcados na partida? üéä",
                                range: [400, 999]
                            }
                        ]
                    },
                    mestre: {
                        name: "‚ö° MESTRE",
                        emoji: "‚ö°",
                        questions: [
                            {
                                context: "üöÄ A startup de games faturou R$ {a} em janeiro e R$ {b} em fevereiro. Qual foi o faturamento total do bimestre? üíº",
                                range: [1000, 5000]
                            },
                            {
                                context: "üé™ O festival de jogos vendeu {a} ingressos online e {b} ingressos na bilheteria. Quantas pessoas participaram do evento? üé´",
                                range: [2000, 8000]
                            },
                            {
                                context: "üè≠ A f√°brica de consoles produziu {a} unidades no primeiro turno e {b} unidades no segundo turno. Qual foi a produ√ß√£o total do dia? üéÆ",
                                range: [3000, 9000]
                            },
                            {
                                context: "üíé O colecionador de NFTs comprou um por {a} tokens e outro por {b} tokens. Quanto ele gastou no total? üñºÔ∏è",
                                range: [5000, 15000]
                            },
                            {
                                context: "üåç O servidor global tem {a} jogadores da Am√©rica e {b} jogadores da Europa. Quantos jogadores est√£o online? üåê",
                                range: [8000, 25000]
                            }
                        ]
                    },
                    expert: {
                        name: "üëë EXPERT",
                        emoji: "üëë",
                        questions: [
                            {
                                context: "üè¢ A corpora√ß√£o de tecnologia faturou R$ {a} no Q1 e R$ {b} no Q2. Qual foi a receita do semestre? üìä",
                                range: [25000, 50000]
                            },
                            {
                                context: "üé¨ O filme de anima√ß√£o custou R$ {a} para produzir e R$ {b} para marketing. Qual foi o investimento total? üé≠",
                                range: [30000, 80000]
                            },
                            {
                                context: "üè∞ O MMO registrou {a} jogadores novos e {b} jogadores retornando. Quantos acessos √∫nicos teve o servidor? ‚öîÔ∏è",
                                range: [45000, 99000]
                            },
                            {
                                context: "üöÅ A empresa de drones vendeu {a} unidades para empresas e {b} unidades para consumidores. Total de drones vendidos? üõ∏",
                                range: [60000, 99000]
                            },
                            {
                                context: "üåü O influencer tech alcan√ßou {a} visualiza√ß√µes no primeiro v√≠deo e {b} no segundo. Quantas views ele teve ao todo? üìπ",
                                range: [75000, 99000]
                            }
                        ]
                    }
                };

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateProgressIndicators();
                this.generateQuestion();
                this.updateStats();
            }

            setupEventListeners() {
                // Level selector
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentLevel = e.target.dataset.level;
                        this.currentQuestion = 0;
                        this.updateProgressIndicators();
                        this.generateQuestion();
                    });
                });

                // Mode selector
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentMode = e.target.dataset.mode;
                        this.generateQuestion();
                    });
                });
            }

            updateProgressIndicators() {
                const progressContainer = document.getElementById('blockProgress');
                progressContainer.innerHTML = '';
                
                for (let i = 0; i < 5; i++) {
                    const indicator = document.createElement('div');
                    indicator.className = 'question-indicator';
                    indicator.textContent = i + 1;
                    
                    if (i < this.currentQuestion) {
                        indicator.classList.add('completed');
                    } else if (i === this.currentQuestion) {
                        indicator.classList.add('current');
                    } else {
                        indicator.classList.add('pending');
                    }
                    
                    progressContainer.appendChild(indicator);
                }

                document.getElementById('currentQuestionText').textContent = 
                    `Quest√£o ${this.currentQuestion + 1} de 5 - ${this.levels[this.currentLevel].name}`;
            }

            generateQuestion() {
                const levelData = this.levels[this.currentLevel];
                const questionData = levelData.questions[this.currentQuestion];
                const [min, max] = questionData.range;
                
                const a = Math.floor(Math.random() * (max - min)) + min;
                const b = Math.floor(Math.random() * (max - min)) + min;
                
                this.currentQuestionData = {
                    a,
                    b,
                    result: a + b,
                    context: questionData.context.replace('{a}', a.toLocaleString()).replace('{b}', b.toLocaleString()),
                    attempts: 0
                };

                this.calculatorDisplay = '0';
                this.currentExpression = '';
                this.userAnswer = null;
                this.attempts = 0;

                if (this.currentMode === 'montador') {
                    this.renderCalculatorMode();
                } else {
                    this.renderDetectorMode();
                }
            }

            renderCalculatorMode() {
                const gameArea = document.getElementById('gameArea');
                const { a, b, result, context } = this.currentQuestionData;

                gameArea.innerHTML = `
                    <div class="context-box">${context}</div>
                    
                    <div class="calculator-layout">
                        <div class="calculator-container">
                            <div class="calculator-title">üßÆ USE A CALCULADORA</div>
                            <div class="calculator-display" id="calcDisplay">0</div>
                            <div class="calculator-buttons">
                                <button class="calc-btn clear" onclick="calculator.clearAll()">C</button>
                                <button class="calc-btn clear" onclick="calculator.clearEntry()">CE</button>
                                <button class="calc-btn operator" onclick="calculator.inputOperator('/')">/</button>
                                <button class="calc-btn operator" onclick="calculator.inputOperator('*')">√ó</button>
                                
                                <button class="calc-btn number" onclick="calculator.inputNumber('7')">7</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('8')">8</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('9')">9</button>
                                <button class="calc-btn operator" onclick="calculator.inputOperator('-')">-</button>
                                
                                <button class="calc-btn number" onclick="calculator.inputNumber('4')">4</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('5')">5</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('6')">6</button>
                                <button class="calc-btn operator" onclick="calculator.inputOperator('+')">+</button>
                                
                                <button class="calc-btn number" onclick="calculator.inputNumber('1')">1</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('2')">2</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('3')">3</button>
                                <button class="calc-btn equals" onclick="calculator.calculate()" rowspan="2">=</button>
                                
                                <button class="calc-btn number" onclick="calculator.inputNumber('0')" style="grid-column: span 2;">0</button>
                                <button class="calc-btn number" onclick="calculator.inputNumber('.')">.</button>
                            </div>
                        </div>

                        <div class="answer-container">
                            <div class="answer-title">üéØ RESULTADO ESPERADO</div>
                            <div class="expected-result">${result.toLocaleString()}</div>
                            
                            <div class="answer-title">ü§î SUA RESPOSTA</div>
                            <div class="your-answer" id="userAnswerDisplay">
                                Calcule usando a calculadora
                            </div>
                            
                            <div class="status-message waiting" id="statusMessage">
                                ‚è≥ Aguardando c√°lculo...
                            </div>
                            
                            <div class="attempts-info" id="attemptsInfo">
                                Voc√™ tem 2 tentativas
                            </div>
                        </div>
                    </div>
                `;

                this.updateDisplay();
            }

            renderDetectorMode() {
                const gameArea = document.getElementById('gameArea');
                const { a, b, result, context } = this.currentQuestionData;

                gameArea.innerHTML = `
                    <div class="context-box">${context}</div>
                    
                    <div class="detector-layout">
                        <div class="broken-calculator">
                            <div class="calculation-display">
                                  ${a.toLocaleString()}<br>
                                + ${b.toLocaleString()}<br>
                                ___________<br>
                                = ???????
                            </div>
                        </div>

                        <div style="text-align: center; font-size: 24px; margin: 30px 0; color: #e17055;">
                            ü§ñ SISTEMA BUGADO! CALCULE MANUALMENTE! üîß
                        </div>

                        <div class="manual-input-area">
                            <input type="number" class="manual-input" id="resultInput" placeholder="?" maxlength="8">
                            <button class="check-btn" onclick="calculator.checkDetectorAnswer()">
                                ‚úÖ VERIFICAR RESPOSTA
                            </button>
                        </div>

                        <div class="attempts-info" style="text-align: center;">
                            Tentativa ${this.attempts + 1} de 2
                        </div>
                    </div>
                `;

                setTimeout(() => document.getElementById('resultInput').focus(), 100);
                
                // Enter key support
                document.getElementById('resultInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.checkDetectorAnswer();
                    }
                });
            }

            // M√©todos da Calculadora
            inputNumber(num) {
                if (this.calculatorDisplay === '0') {
                    this.calculatorDisplay = num;
                } else {
                    this.calculatorDisplay += num;
                }
                this.updateDisplay();
            }

            inputOperator(op) {
                if (this.currentExpression === '') {
                    this.currentExpression = this.calculatorDisplay + ' ' + op + ' ';
                } else {
                    // Se j√° tem uma express√£o, calcula primeiro
                    this.calculate();
                    this.currentExpression = this.calculatorDisplay + ' ' + op + ' ';
                }
                this.calculatorDisplay = '0';
                this.updateDisplay();
            }

            calculate() {
                if (this.currentExpression !== '') {
                    try {
                        const expression = this.currentExpression + this.calculatorDisplay;
                        // Substituir √ó por * para eval
                        const cleanExpression = expression.replace(/√ó/g, '*');
                        const result = eval(cleanExpression);
                        
                        this.userAnswer = Math.round(result);
                        this.calculatorDisplay = this.userAnswer.toString();
                        this.currentExpression = '';
                        
                        this.updateDisplay();
                        this.checkAnswer();
                    } catch (e) {
                        this.calculatorDisplay = 'Erro';
                        this.updateDisplay();
                    }
                }
            }

            clearAll() {
                this.calculatorDisplay = '0';
                this.currentExpression = '';
                this.updateDisplay();
            }

            clearEntry() {
                this.calculatorDisplay = '0';
                this.updateDisplay();
            }

            updateDisplay() {
                const display = document.getElementById('calcDisplay');
                if (display) {
                    if (this.currentExpression !== '') {
                        display.textContent = this.currentExpression + this.calculatorDisplay;
                    } else {
                        display.textContent = this.calculatorDisplay;
                    }
                }
            }

            checkAnswer() {
                const userAnswerDisplay = document.getElementById('userAnswerDisplay');
                const statusMessage = document.getElementById('statusMessage');
                const attemptsInfo = document.getElementById('attemptsInfo');
                
                if (!userAnswerDisplay) return;

                userAnswerDisplay.textContent = this.userAnswer.toLocaleString();
                this.attempts++;

                if (this.userAnswer === this.currentQuestionData.result) {
                    userAnswerDisplay.classList.add('correct');
                    statusMessage.className = 'status-message correct';
                    statusMessage.textContent = 'üéâ CORRETO! Parab√©ns!';
                    this.showSuccess("üöÄ PERFEITO! Voc√™ dominou a calculadora!");
                } else {
                    userAnswerDisplay.classList.add('incorrect');
                    statusMessage.className = 'status-message incorrect';
                    
                    if (this.attempts === 1) {
                        statusMessage.textContent = '‚ùå Ops! Tente novamente!';
                        attemptsInfo.textContent = 'Voc√™ tem mais 1 tentativa';
                        // Reset para nova tentativa
                        setTimeout(() => {
                            userAnswerDisplay.classList.remove('incorrect');
                            userAnswerDisplay.textContent = 'Tente novamente';
                            statusMessage.className = 'status-message waiting';
                            statusMessage.textContent = '‚è≥ Aguardando nova tentativa...';
                            this.userAnswer = null;
                            this.clearAll();
                        }, 2000);
                    } else {
                        statusMessage.textContent = `üéØ Resposta correta: ${this.currentQuestionData.result.toLocaleString()}`;
                        this.showExplanation();
                        setTimeout(() => this.nextQuestion(), 4000);
                    }
                }
            }

            checkDetectorAnswer() {
                const userAnswer = parseInt(document.getElementById('resultInput').value);
                const correctAnswer = this.currentQuestionData.result;

                this.attempts++;

                if (userAnswer === correctAnswer) {
                    this.showSuccess("üöÄ INCR√çVEL! Voc√™ √© mais r√°pido que a m√°quina!");
                } else {
                    if (this.attempts === 1) {
                        this.showError("üéØ Quase l√°! Tente mais uma vez!");
                        document.getElementById('resultInput').value = '';
                        document.getElementById('resultInput').focus();
                        // Atualizar contador de tentativas
                        const attemptsInfo = document.querySelector('.attempts-info');
                        attemptsInfo.textContent = `Tentativa ${this.attempts + 1} de 2`;
                    } else {
                        this.showError(`üìö Resposta correta: ${correctAnswer.toLocaleString()}`);
                        this.showExplanation();
                        setTimeout(() => this.nextQuestion(), 4000);
                    }
                }
            }

            showExplanation() {
                const feedback = document.getElementById('feedback');
                const { a, b, result } = this.currentQuestionData;
                
                feedback.innerHTML = `
                    <div class="explanation">
                        <h4>üìñ Como resolver:</h4>
                        <p><strong>Passo 1:</strong> Organize os n√∫meros verticalmente</p>
                        <p style="font-family: monospace; font-size: 18px; margin: 10px 0;">
                              ${a.toLocaleString()}<br>
                            + ${b.toLocaleString()}<br>
                            ___________
                        </p>
                        <p><strong>Passo 2:</strong> Some da direita para a esquerda</p>
                        <p><strong>Resultado:</strong> ${result.toLocaleString()}</p>
                    </div>
                `;
                feedback.style.display = 'block';
            }

            showSuccess(message) {
                this.questionsAnswered++;
                this.correctAnswers++;
                this.currentStreak++;
                
                // Pontua√ß√£o baseada no n√≠vel e tentativas
                const levelMultiplier = {avancado: 100, mestre: 200, expert: 300};
                const attemptsBonus = this.attempts === 1 ? 2 : 1;
                this.totalScore += levelMultiplier[this.currentLevel] * attemptsBonus;

                const feedback = document.getElementById('feedback');
                feedback.className = 'feedback success';
                feedback.textContent = message;
                feedback.style.display = 'block';

                this.updateStats();
                setTimeout(() => this.nextQuestion(), 2500);
            }

            showError(message) {
                if (message.includes('Resposta correta')) {
                    this.questionsAnswered++;
                    this.currentStreak = 0;
                }

                const feedback = document.getElementById('feedback');
                feedback.className = 'feedback error';
                feedback.textContent = message;
                feedback.style.display = 'block';

                this.updateStats();
            }

            nextQuestion() {
                document.getElementById('feedback').style.display = 'none';
                
                this.currentQuestion++;
                if (this.currentQuestion >= 5) {
                    this.showLevelComplete();
                    return;
                }

                this.updateProgressIndicators();
                this.generateQuestion();
            }

            showLevelComplete() {
                const gameArea = document.getElementById('gameArea');
                const levelEmoji = this.levels[this.currentLevel].emoji;
                
                gameArea.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <div style="font-size: 80px; margin-bottom: 20px;">${levelEmoji}</div>
                        <h2 style="font-size: 36px; margin-bottom: 20px; color: #2d3436;">
                            üéä N√çVEL CONCLU√çDO! üéä
                        </h2>
                        <p style="font-size: 24px; margin-bottom: 30px;">
                            Voc√™ dominou o n√≠vel <strong>${this.levels[this.currentLevel].name}</strong>!
                        </p>
                        <div style="font-size: 20px; margin-bottom: 30px;">
                            üèÜ Pontua√ß√£o Final: <strong>${this.totalScore.toLocaleString()}</strong><br>
                            üî• Maior Sequ√™ncia: <strong>${this.currentStreak}</strong><br>
                            üéØ Precis√£o: <strong>${Math.round((this.correctAnswers / this.questionsAnswered) * 100)}%</strong>
                        </div>
                        <button class="check-btn" onclick="calculator.resetLevel()" style="font-size: 20px; padding: 20px 40px;">
                            üîÑ JOGAR NOVAMENTE
                        </button>
                    </div>
                `;
            }

            resetLevel() {
                this.currentQuestion = 0;
                this.updateProgressIndicators();
                this.generateQuestion();
            }

            updateStats() {
                document.getElementById('totalScore').textContent = this.totalScore.toLocaleString();
                document.getElementById('currentStreak').textContent = this.currentStreak;
                document.getElementById('levelProgress').textContent = `${this.currentQuestion}/5`;
                document.getElementById('accuracy').textContent = 
                    this.questionsAnswered > 0 ? 
                    Math.round((this.correctAnswers / this.questionsAnswered) * 100) + '%' : '100%';
            }
        }

        // Inicializar aplica√ß√£o
        const calculator = new CalculadoraExpert();
    </script>
</body>
</html>